<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7.7 LookAt na prática | MCTA008-17 Computação Gráfica</title>
  <meta name="description" content="Notas de aula de MCTA008-17 Computação Gráfica da Universidade Federal do ABC" />
  <meta name="generator" content="bookdown 0.21.2 and GitBook 2.6.7" />

  <meta property="og:title" content="7.7 LookAt na prática | MCTA008-17 Computação Gráfica" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Notas de aula de MCTA008-17 Computação Gráfica da Universidade Federal do ABC" />
  <meta name="github-repo" content="hbatagelo/cgbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7.7 LookAt na prática | MCTA008-17 Computação Gráfica" />
  
  <meta name="twitter:description" content="Notas de aula de MCTA008-17 Computação Gráfica da Universidade Federal do ABC" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="lookat.html"/>
<link rel="next" href="projections.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { font-weight: bold; } /* Alert */
code span.an { font-style: italic; } /* Annotation */
code span.cf { font-weight: bold; } /* ControlFlow */
code span.co { font-style: italic; } /* Comment */
code span.cv { font-style: italic; } /* CommentVar */
code span.do { font-style: italic; } /* Documentation */
code span.dt { text-decoration: underline; } /* DataType */
code span.er { font-weight: bold; } /* Error */
code span.in { font-style: italic; } /* Information */
code span.kw { font-weight: bold; } /* Keyword */
code span.pp { font-weight: bold; } /* Preprocessor */
code span.wa { font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Computação Gráfica</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Apresentação</a><ul>
<li class="chapter" data-level="" data-path="pré-requisitos.html"><a href="pré-requisitos.html"><i class="fa fa-check"></i>Pré-requisitos</a><ul>
<li class="chapter" data-level="" data-path="pré-requisitos.html"><a href="pré-requisitos.html#atividades-práticas"><i class="fa fa-check"></i>Atividades práticas</a></li>
<li class="chapter" data-level="" data-path="pré-requisitos.html"><a href="pré-requisitos.html#visualizando-este-site"><i class="fa fa-check"></i>Visualizando este site</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="config.html"><a href="config.html"><i class="fa fa-check"></i><b>1</b> Configuração do ambiente</a><ul>
<li class="chapter" data-level="1.1" data-path="linux.html"><a href="linux.html"><i class="fa fa-check"></i><b>1.1</b> Linux</a><ul>
<li class="chapter" data-level="" data-path="linux.html"><a href="linux.html#habilitando-o-opengl"><i class="fa fa-check"></i>Habilitando o OpenGL</a></li>
<li class="chapter" data-level="" data-path="linux.html"><a href="linux.html#atualizando-o-gcc"><i class="fa fa-check"></i>Atualizando o GCC</a></li>
<li class="chapter" data-level="" data-path="linux.html"><a href="linux.html#instalando-o-emscripten"><i class="fa fa-check"></i>Instalando o Emscripten</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="macos.html"><a href="macos.html"><i class="fa fa-check"></i><b>1.2</b> macOS</a><ul>
<li class="chapter" data-level="" data-path="macos.html"><a href="macos.html#instalando-o-emscripten-1"><i class="fa fa-check"></i>Instalando o Emscripten</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="windows.html"><a href="windows.html"><i class="fa fa-check"></i><b>1.3</b> Windows</a><ul>
<li class="chapter" data-level="" data-path="windows.html"><a href="windows.html#habilitando-o-opengl-1"><i class="fa fa-check"></i>Habilitando o OpenGL</a></li>
<li class="chapter" data-level="" data-path="windows.html"><a href="windows.html#instalando-o-emscripten-2"><i class="fa fa-check"></i>Instalando o Emscripten</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="vscode.html"><a href="vscode.html"><i class="fa fa-check"></i><b>1.4</b> Visual Studio Code</a></li>
<li class="chapter" data-level="1.5" data-path="abcg.html"><a href="abcg.html"><i class="fa fa-check"></i><b>1.5</b> ABCg</a><ul>
<li class="chapter" data-level="" data-path="abcg.html"><a href="abcg.html#instalação"><i class="fa fa-check"></i>Instalação</a></li>
<li class="chapter" data-level="" data-path="abcg.html"><a href="abcg.html#compilando-em-linha-de-comando"><i class="fa fa-check"></i>Compilando em linha de comando</a></li>
<li class="chapter" data-level="" data-path="abcg.html"><a href="abcg.html#compilando-no-visual-studio-code"><i class="fa fa-check"></i>Compilando no Visual Studio Code</a></li>
<li class="chapter" data-level="" data-path="abcg.html"><a href="abcg.html#depurando-no-visual-studio-code"><i class="fa fa-check"></i>Depurando no Visual Studio Code</a></li>
<li class="chapter" data-level="" data-path="abcg.html"><a href="abcg.html#compilando-para-webassembly"><i class="fa fa-check"></i>Compilando para WebAssembly</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introdução</a><ul>
<li class="chapter" data-level="2.1" data-path="áreas-correlatas.html"><a href="áreas-correlatas.html"><i class="fa fa-check"></i><b>2.1</b> Áreas correlatas</a></li>
<li class="chapter" data-level="2.2" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html"><i class="fa fa-check"></i><b>2.2</b> Linha do tempo</a><ul>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section"><i class="fa fa-check"></i>1950</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-1"><i class="fa fa-check"></i>1960</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-2"><i class="fa fa-check"></i>1970</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-3"><i class="fa fa-check"></i>1980</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-4"><i class="fa fa-check"></i>1990</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-5"><i class="fa fa-check"></i>2000</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-6"><i class="fa fa-check"></i>2010</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-7"><i class="fa fa-check"></i>2020</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="firstapp.html"><a href="firstapp.html"><i class="fa fa-check"></i><b>2.3</b> Primeiro programa</a><ul>
<li class="chapter" data-level="" data-path="firstapp.html"><a href="firstapp.html#configuração-inicial"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="firstapp.html"><a href="firstapp.html#main.cpp"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="firstapp.html"><a href="firstapp.html#openglwindow.hpp"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="firstapp.html"><a href="firstapp.html#openglwindow.cpp"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
<li class="chapter" data-level="" data-path="firstapp.html"><a href="firstapp.html#compilando-para-webassembly-1"><i class="fa fa-check"></i>Compilando para WebAssembly</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="graphicssystem.html"><a href="graphicssystem.html"><i class="fa fa-check"></i><b>3</b> Sistemas gráficos</a><ul>
<li class="chapter" data-level="3.1" data-path="vectorxraster.html"><a href="vectorxraster.html"><i class="fa fa-check"></i><b>3.1</b> Vetorial <em>x</em> matricial</a><ul>
<li class="chapter" data-level="" data-path="vectorxraster.html"><a href="vectorxraster.html#representação-vetorial"><i class="fa fa-check"></i>Representação vetorial</a></li>
<li class="chapter" data-level="" data-path="vectorxraster.html"><a href="vectorxraster.html#representação-matricial"><i class="fa fa-check"></i>Representação matricial</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="es.html"><a href="es.html"><i class="fa fa-check"></i><b>3.2</b> Dispositivos de E/S</a><ul>
<li class="chapter" data-level="" data-path="es.html"><a href="es.html#dispositivos-de-entrada"><i class="fa fa-check"></i>Dispositivos de entrada</a></li>
<li class="chapter" data-level="" data-path="es.html"><a href="es.html#dispositivos-de-saída"><i class="fa fa-check"></i>Dispositivos de saída</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="framebuffer.html"><a href="framebuffer.html"><i class="fa fa-check"></i><b>3.3</b> Framebuffer</a><ul>
<li class="chapter" data-level="" data-path="framebuffer.html"><a href="framebuffer.html#screen-tearing"><i class="fa fa-check"></i>Screen tearing</a></li>
<li class="chapter" data-level="" data-path="framebuffer.html"><a href="framebuffer.html#vsync"><i class="fa fa-check"></i>Vsync</a></li>
<li class="chapter" data-level="" data-path="framebuffer.html"><a href="framebuffer.html#backbuffering"><i class="fa fa-check"></i>Backbuffering</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sierpinski.html"><a href="sierpinski.html"><i class="fa fa-check"></i><b>3.4</b> Triângulo de Sierpinski</a><ul>
<li class="chapter" data-level="" data-path="sierpinski.html"><a href="sierpinski.html#configuração-inicial-1"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="sierpinski.html"><a href="sierpinski.html#main.cpp-1"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="sierpinski.html"><a href="sierpinski.html#openglwindow.hpp-1"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="sierpinski.html"><a href="sierpinski.html#openglwindow.cpp-1"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="pipeline.html"><a href="pipeline.html"><i class="fa fa-check"></i><b>4</b> Pipeline gráfico</a><ul>
<li class="chapter" data-level="4.1" data-path="dados-gráficos.html"><a href="dados-gráficos.html"><i class="fa fa-check"></i><b>4.1</b> Dados gráficos</a></li>
<li class="chapter" data-level="4.2" data-path="ray-casting-x-rasterização.html"><a href="ray-casting-x-rasterização.html"><i class="fa fa-check"></i><b>4.2</b> Ray casting <em>x</em> rasterização</a><ul>
<li class="chapter" data-level="" data-path="ray-casting-x-rasterização.html"><a href="ray-casting-x-rasterização.html#ray-casting"><i class="fa fa-check"></i>Ray casting</a></li>
<li class="chapter" data-level="" data-path="ray-casting-x-rasterização.html"><a href="ray-casting-x-rasterização.html#rasterização"><i class="fa fa-check"></i>Rasterização</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="glpipeline.html"><a href="glpipeline.html"><i class="fa fa-check"></i><b>4.3</b> Pipeline do OpenGL</a><ul>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#aplicação"><i class="fa fa-check"></i>Aplicação</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#vertex-shader"><i class="fa fa-check"></i>Vertex shader</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#montagem-de-primitivas"><i class="fa fa-check"></i>Montagem de primitivas</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#recorte"><i class="fa fa-check"></i>Recorte</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#rasterização-1"><i class="fa fa-check"></i>Rasterização</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#fragment-shader"><i class="fa fa-check"></i>Fragment shader</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#operações-de-fragmentos"><i class="fa fa-check"></i>Operações de fragmentos</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="coloredtriangles.html"><a href="coloredtriangles.html"><i class="fa fa-check"></i><b>4.4</b> Triângulos coloridos</a><ul>
<li class="chapter" data-level="" data-path="coloredtriangles.html"><a href="coloredtriangles.html#configuração-inicial-2"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="coloredtriangles.html"><a href="coloredtriangles.html#main.cpp-2"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="coloredtriangles.html"><a href="coloredtriangles.html#openglwindow.hpp-2"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="coloredtriangles.html"><a href="coloredtriangles.html#openglwindow.cpp-2"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="game.html"><a href="game.html"><i class="fa fa-check"></i><b>5</b> Desenvolvendo um jogo 2D</a><ul>
<li class="chapter" data-level="5.1" data-path="regularpolygons.html"><a href="regularpolygons.html"><i class="fa fa-check"></i><b>5.1</b> Polígonos regulares</a><ul>
<li class="chapter" data-level="" data-path="regularpolygons.html"><a href="regularpolygons.html#configuração-inicial-3"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="regularpolygons.html"><a href="regularpolygons.html#main.cpp-3"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="regularpolygons.html"><a href="regularpolygons.html#openglwindow.hpp-3"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="regularpolygons.html"><a href="regularpolygons.html#openglwindow.cpp-3"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="asteroids.html"><a href="asteroids.html"><i class="fa fa-check"></i><b>5.2</b> Asteroids</a><ul>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#organização-do-projeto"><i class="fa fa-check"></i>Organização do projeto</a></li>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#configuração-inicial-4"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#nave"><i class="fa fa-check"></i>Nave</a></li>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#estrelas"><i class="fa fa-check"></i>Estrelas</a></li>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#asteroides"><i class="fa fa-check"></i>Asteroides</a></li>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#tiros-e-colisões"><i class="fa fa-check"></i>Tiros e colisões</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="geometry.html"><a href="geometry.html"><i class="fa fa-check"></i><b>6</b> Espaços e geometria</a><ul>
<li class="chapter" data-level="6.1" data-path="vector.html"><a href="vector.html"><i class="fa fa-check"></i><b>6.1</b> Espaço vetorial</a><ul>
<li class="chapter" data-level="" data-path="vector.html"><a href="vector.html#combinação-e-independência-linear"><i class="fa fa-check"></i>Combinação e independência linear</a></li>
<li class="chapter" data-level="" data-path="vector.html"><a href="vector.html#dimensão-e-base"><i class="fa fa-check"></i>Dimensão e base</a></li>
<li class="chapter" data-level="" data-path="vector.html"><a href="vector.html#vetores-geométricos"><i class="fa fa-check"></i>Vetores geométricos</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="affine.html"><a href="affine.html"><i class="fa fa-check"></i><b>6.2</b> Espaço afim</a><ul>
<li class="chapter" data-level="" data-path="affine.html"><a href="affine.html#combinação-afim"><i class="fa fa-check"></i>Combinação afim</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="euclidean.html"><a href="euclidean.html"><i class="fa fa-check"></i><b>6.3</b> Espaço euclidiano</a><ul>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#frames"><i class="fa fa-check"></i>Frames</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#produto-escalar"><i class="fa fa-check"></i>Produto escalar</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#ortogonalidade"><i class="fa fa-check"></i>Ortogonalidade</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#comprimento-e-distância"><i class="fa fa-check"></i>Comprimento e distância</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#normalização"><i class="fa fa-check"></i>Normalização</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#ângulo-entre-vetores"><i class="fa fa-check"></i>Ângulo entre vetores</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#projeção-ortogonal"><i class="fa fa-check"></i>Projeção ortogonal</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#produto-vetorial"><i class="fa fa-check"></i>Produto vetorial</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#vetor-normal"><i class="fa fa-check"></i>Vetor normal</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="objmodel.html"><a href="objmodel.html"><i class="fa fa-check"></i><b>6.4</b> Lendo um modelo 3D</a><ul>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#orientação-e-face-culling"><i class="fa fa-check"></i>Orientação e face culling</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#configuração-inicial-5"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#main.cpp-5"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#loadmodel.vert"><i class="fa fa-check"></i>loadmodel.vert</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#loadmodel.frag"><i class="fa fa-check"></i>loadmodel.frag</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#openglwindow.hpp-5"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#openglwindow.cpp-5"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="transformations.html"><a href="transformations.html"><i class="fa fa-check"></i><b>7</b> Matrizes e transformações</a><ul>
<li class="chapter" data-level="7.1" data-path="matrix.html"><a href="matrix.html"><i class="fa fa-check"></i><b>7.1</b> Matrizes</a><ul>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-transposta"><i class="fa fa-check"></i>Matriz transposta</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-quadrada"><i class="fa fa-check"></i>Matriz quadrada</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-linhacoluna"><i class="fa fa-check"></i>Matriz linha/coluna</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-identidade"><i class="fa fa-check"></i>Matriz identidade</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#operações"><i class="fa fa-check"></i>Operações</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-inversa"><i class="fa fa-check"></i>Matriz inversa</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-ortogonal"><i class="fa fa-check"></i>Matriz ortogonal</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#propriedades"><i class="fa fa-check"></i>Propriedades</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#transformação"><i class="fa fa-check"></i>Transformação</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="homogeneous.html"><a href="homogeneous.html"><i class="fa fa-check"></i><b>7.2</b> Coordenadas homogêneas</a></li>
<li class="chapter" data-level="7.3" data-path="concat.html"><a href="concat.html"><i class="fa fa-check"></i><b>7.3</b> Concatenação de transformações</a></li>
<li class="chapter" data-level="7.4" data-path="transforms.html"><a href="transforms.html"><i class="fa fa-check"></i><b>7.4</b> Transformações</a><ul>
<li class="chapter" data-level="" data-path="transforms.html"><a href="transforms.html#identidade"><i class="fa fa-check"></i>Identidade</a></li>
<li class="chapter" data-level="" data-path="transforms.html"><a href="transforms.html#translação"><i class="fa fa-check"></i>Translação</a></li>
<li class="chapter" data-level="" data-path="transforms.html"><a href="transforms.html#escala"><i class="fa fa-check"></i>Escala</a></li>
<li class="chapter" data-level="" data-path="transforms.html"><a href="transforms.html#rotação"><i class="fa fa-check"></i>Rotação</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="glspaces.html"><a href="glspaces.html"><i class="fa fa-check"></i><b>7.5</b> Espaços do OpenGL</a><ul>
<li class="chapter" data-level="" data-path="glspaces.html"><a href="glspaces.html#espaço-do-objeto"><i class="fa fa-check"></i>Espaço do objeto</a></li>
<li class="chapter" data-level="" data-path="glspaces.html"><a href="glspaces.html#espaço-do-mundo"><i class="fa fa-check"></i>Espaço do mundo</a></li>
<li class="chapter" data-level="" data-path="glspaces.html"><a href="glspaces.html#espaço-da-câmera"><i class="fa fa-check"></i>Espaço da câmera</a></li>
<li class="chapter" data-level="" data-path="glspaces.html"><a href="glspaces.html#concatenação-das-matrizes-de-modelo-e-visão"><i class="fa fa-check"></i>Concatenação das matrizes de modelo e visão</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="lookat.html"><a href="lookat.html"><i class="fa fa-check"></i><b>7.6</b> Câmera LookAt</a><ul>
<li class="chapter" data-level="" data-path="lookat.html"><a href="lookat.html#construindo-o-vetor-n"><i class="fa fa-check"></i>Construindo o vetor n</a></li>
<li class="chapter" data-level="" data-path="lookat.html"><a href="lookat.html#construindo-o-vetor-u"><i class="fa fa-check"></i>Construindo o vetor u</a></li>
<li class="chapter" data-level="" data-path="lookat.html"><a href="lookat.html#construindo-o-vetor-v"><i class="fa fa-check"></i>Construindo o vetor v</a></li>
<li class="chapter" data-level="" data-path="lookat.html"><a href="lookat.html#construindo-a-matriz-de-visão"><i class="fa fa-check"></i>Construindo a matriz de visão</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="lookatproject.html"><a href="lookatproject.html"><i class="fa fa-check"></i><b>7.7</b> LookAt na prática</a><ul>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#configuração-inicial-6"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#main.cpp-6"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#lookat.vert"><i class="fa fa-check"></i>lookat.vert</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#lookat.frag"><i class="fa fa-check"></i>lookat.frag</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#camera.hpp"><i class="fa fa-check"></i>camera.hpp</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#camera.cpp"><i class="fa fa-check"></i>camera.cpp</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#openglwindow.hpp-6"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#openglwindow.cpp-6"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="projections.html"><a href="projections.html"><i class="fa fa-check"></i><b>8</b> Projeções e trackball virtual</a><ul>
<li class="chapter" data-level="8.1" data-path="ortho.html"><a href="ortho.html"><i class="fa fa-check"></i><b>8.1</b> Projeção ortográfica</a><ul>
<li class="chapter" data-level="" data-path="ortho.html"><a href="ortho.html#translação-1"><i class="fa fa-check"></i>Translação</a></li>
<li class="chapter" data-level="" data-path="ortho.html"><a href="ortho.html#escala-e-reflexão"><i class="fa fa-check"></i>Escala e reflexão</a></li>
<li class="chapter" data-level="" data-path="ortho.html"><a href="ortho.html#matriz-de-projeção"><i class="fa fa-check"></i>Matriz de projeção</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="perspective.html"><a href="perspective.html"><i class="fa fa-check"></i><b>8.2</b> Projeção perspectiva</a><ul>
<li class="chapter" data-level="" data-path="perspective.html"><a href="perspective.html#matriz-de-projeção-1"><i class="fa fa-check"></i>Matriz de projeção</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="vtrackball1.html"><a href="vtrackball1.html"><i class="fa fa-check"></i><b>8.3</b> Trackball virtual</a><ul>
<li class="chapter" data-level="" data-path="vtrackball1.html"><a href="vtrackball1.html#rotação-em-torno-de-um-eixo-arbitrário"><i class="fa fa-check"></i>Rotação em torno de um eixo arbitrário</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="viewer1.html"><a href="viewer1.html"><i class="fa fa-check"></i><b>8.4</b> Visualizador 3D</a><ul>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#configuração-inicial-7"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#main.cpp-7"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#depth.vert"><i class="fa fa-check"></i>depth.vert</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#depth.frag"><i class="fa fa-check"></i>depth.frag</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#model.hpp"><i class="fa fa-check"></i>model.hpp</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#model.cpp"><i class="fa fa-check"></i>model.cpp</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#trackball.hpp"><i class="fa fa-check"></i>trackball.hpp</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#trackball.cpp"><i class="fa fa-check"></i>trackball.cpp</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#openglwindow.hpp-7"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#openglwindow.cpp-7"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="starfield.html"><a href="starfield.html"><i class="fa fa-check"></i><b>8.5</b> Efeito starfield</a><ul>
<li class="chapter" data-level="" data-path="starfield.html"><a href="starfield.html#configuração-inicial-8"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="starfield.html"><a href="starfield.html#main.cpp-8"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="starfield.html"><a href="starfield.html#depth.vert-1"><i class="fa fa-check"></i>depth.vert</a></li>
<li class="chapter" data-level="" data-path="starfield.html"><a href="starfield.html#depth.frag-1"><i class="fa fa-check"></i>depth.frag</a></li>
<li class="chapter" data-level="" data-path="starfield.html"><a href="starfield.html#openglwindow.hpp-8"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="starfield.html"><a href="starfield.html#openglwindow.cpp-8"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="lighting.html"><a href="lighting.html"><i class="fa fa-check"></i><b>9</b> Iluminação</a><ul>
<li class="chapter" data-level="9.1" data-path="renderingequation.html"><a href="renderingequation.html"><i class="fa fa-check"></i><b>9.1</b> Equação de renderização</a></li>
<li class="chapter" data-level="9.2" data-path="phongmodel.html"><a href="phongmodel.html"><i class="fa fa-check"></i><b>9.2</b> Modelo de reflexão de Phong</a><ul>
<li class="chapter" data-level="" data-path="phongmodel.html"><a href="phongmodel.html#reflexão-ambiente"><i class="fa fa-check"></i>Reflexão ambiente</a></li>
<li class="chapter" data-level="" data-path="phongmodel.html"><a href="phongmodel.html#reflexão-difusa"><i class="fa fa-check"></i>Reflexão difusa</a></li>
<li class="chapter" data-level="" data-path="phongmodel.html"><a href="phongmodel.html#reflexão-especular"><i class="fa fa-check"></i>Reflexão especular</a></li>
<li class="chapter" data-level="" data-path="phongmodel.html"><a href="phongmodel.html#modelo-completo"><i class="fa fa-check"></i>Modelo completo</a></li>
<li class="chapter" data-level="" data-path="phongmodel.html"><a href="phongmodel.html#iluminação-colorida"><i class="fa fa-check"></i>Iluminação colorida</a></li>
<li class="chapter" data-level="" data-path="phongmodel.html"><a href="phongmodel.html#fontes-de-luz"><i class="fa fa-check"></i>Fontes de luz</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="blinnphongmodel.html"><a href="blinnphongmodel.html"><i class="fa fa-check"></i><b>9.3</b> Modelo de Blinn–Phong</a></li>
<li class="chapter" data-level="9.4" data-path="shading.html"><a href="shading.html"><i class="fa fa-check"></i><b>9.4</b> Sombreamento</a><ul>
<li class="chapter" data-level="" data-path="shading.html"><a href="shading.html#flat"><i class="fa fa-check"></i>Flat</a></li>
<li class="chapter" data-level="" data-path="shading.html"><a href="shading.html#gouraud"><i class="fa fa-check"></i>Gouraud</a></li>
<li class="chapter" data-level="" data-path="shading.html"><a href="shading.html#phong"><i class="fa fa-check"></i>Phong</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="viewer2.html"><a href="viewer2.html"><i class="fa fa-check"></i><b>9.5</b> Normais como cores</a><ul>
<li class="chapter" data-level="" data-path="viewer2.html"><a href="viewer2.html#configuração-inicial-9"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="viewer2.html"><a href="viewer2.html#model.hpp-1"><i class="fa fa-check"></i>model.hpp</a></li>
<li class="chapter" data-level="" data-path="viewer2.html"><a href="viewer2.html#model.cpp-1"><i class="fa fa-check"></i>model.cpp</a></li>
<li class="chapter" data-level="" data-path="viewer2.html"><a href="viewer2.html#openglwindow.hpp-9"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="viewer2.html"><a href="viewer2.html#openglwindow.cpp-9"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
<li class="chapter" data-level="" data-path="viewer2.html"><a href="viewer2.html#normal.frag"><i class="fa fa-check"></i>normal.frag</a></li>
<li class="chapter" data-level="" data-path="viewer2.html"><a href="viewer2.html#normal.vert"><i class="fa fa-check"></i>normal.vert</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="viewer3.html"><a href="viewer3.html"><i class="fa fa-check"></i><b>9.6</b> Iluminação na prática</a><ul>
<li class="chapter" data-level="" data-path="viewer3.html"><a href="viewer3.html#phong-com-sombreamento-de-gouraud"><i class="fa fa-check"></i>Phong com sombreamento de Gouraud</a></li>
<li class="chapter" data-level="" data-path="viewer3.html"><a href="viewer3.html#phong-com-sombreamento-de-phong"><i class="fa fa-check"></i>Phong com sombreamento de Phong</a></li>
<li class="chapter" data-level="" data-path="viewer3.html"><a href="viewer3.html#blinn-phong-com-sombreamento-de-phong"><i class="fa fa-check"></i>Blinn-Phong com sombreamento de Phong</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="texturing.html"><a href="texturing.html"><i class="fa fa-check"></i><b>10</b> Texturização</a><ul>
<li class="chapter" data-level="10.1" data-path="texmapping.html"><a href="texmapping.html"><i class="fa fa-check"></i><b>10.1</b> Mapeamento</a><ul>
<li class="chapter" data-level="" data-path="texmapping.html"><a href="texmapping.html#mapeamento-planar"><i class="fa fa-check"></i>Mapeamento planar</a></li>
<li class="chapter" data-level="" data-path="texmapping.html"><a href="texmapping.html#mapeamento-cilíndrico"><i class="fa fa-check"></i>Mapeamento cilíndrico</a></li>
<li class="chapter" data-level="" data-path="texmapping.html"><a href="texmapping.html#mapeamento-esférico"><i class="fa fa-check"></i>Mapeamento esférico</a></li>
<li class="chapter" data-level="" data-path="texmapping.html"><a href="texmapping.html#mapeamento-uv-unwrap"><i class="fa fa-check"></i>Mapeamento UV unwrap</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="texwrapping.html"><a href="texwrapping.html"><i class="fa fa-check"></i><b>10.2</b> Empacotamento</a></li>
<li class="chapter" data-level="10.3" data-path="texfiltering.html"><a href="texfiltering.html"><i class="fa fa-check"></i><b>10.3</b> Filtragem</a><ul>
<li class="chapter" data-level="" data-path="texfiltering.html"><a href="texfiltering.html#magnificação"><i class="fa fa-check"></i>Magnificação</a></li>
<li class="chapter" data-level="" data-path="texfiltering.html"><a href="texfiltering.html#minificação"><i class="fa fa-check"></i>Minificação</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="viewer4.html"><a href="viewer4.html"><i class="fa fa-check"></i><b>10.4</b> Texturização na prática</a><ul>
<li class="chapter" data-level="" data-path="viewer4.html"><a href="viewer4.html#gerando-texturas"><i class="fa fa-check"></i>Gerando texturas</a></li>
<li class="chapter" data-level="" data-path="viewer4.html"><a href="viewer4.html#carregando-modelos-com-textura"><i class="fa fa-check"></i>Carregando modelos com textura</a></li>
<li class="chapter" data-level="" data-path="viewer4.html"><a href="viewer4.html#renderizando"><i class="fa fa-check"></i>Renderizando</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="normalmapping.html"><a href="normalmapping.html"><i class="fa fa-check"></i><b>10.5</b> Mapeamento de normais</a><ul>
<li class="chapter" data-level="" data-path="normalmapping.html"><a href="normalmapping.html#espaço-tangente"><i class="fa fa-check"></i>Espaço tangente</a></li>
<li class="chapter" data-level="" data-path="normalmapping.html"><a href="normalmapping.html#transformação-para-o-espaço-tangente"><i class="fa fa-check"></i>Transformação para o espaço tangente</a></li>
<li class="chapter" data-level="" data-path="normalmapping.html"><a href="normalmapping.html#vetor-tangente-e-bitangente"><i class="fa fa-check"></i>Vetor tangente e bitangente</a></li>
<li class="chapter" data-level="" data-path="normalmapping.html"><a href="normalmapping.html#mapeamento-de-normais-na-prática"><i class="fa fa-check"></i>Mapeamento de normais na prática</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="atividades-entregues.html"><a href="atividades-entregues.html"><i class="fa fa-check"></i>Atividades entregues</a><ul>
<li class="chapter" data-level="" data-path="atividade-1.html"><a href="atividade-1.html"><i class="fa fa-check"></i>Atividade 1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="referências.html"><a href="referências.html"><i class="fa fa-check"></i>Referências</a></li>
<li class="divider"></li>
<li>
<a href="mailto:harlen.batagelo@ufabc.edu.br" target="blank">Harlen Batagelo</a>
</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MCTA008-17 Computação Gráfica</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lookatproject" class="section level2">
<h2><span class="header-section-number">7.7</span> LookAt na prática</h2>
<p>Nesta seção, seguiremos o passo a passo de desenvolvimento de uma aplicação que renderiza uma cena 3D do ponto de vista de uma câmera LookAt.</p>
<p>A cena 3D será composta por quatro instâncias do modelo “Stanford Bunny” dispostos sobre o plano <span class="math inline">\(y=0\)</span>. A câmera LookAt simulará um observador em primeira pessoa. A figura <a href="lookatproject.html#fig:lookatproj1">7.32</a> mostra o posicionamento dos objetos no plano e mostra a localização inicial da câmera.</p>
<div class="figure" style="text-align: center"><span id="fig:lookatproj1"></span>
<img src="images/07_lookatproj1.png" alt="Objetos e elementos de cena dispostos no espaço do mundo."  />
<p class="caption">
Figura 7.32: Objetos e elementos de cena dispostos no espaço do mundo.
</p>
</div>
<p>Na figura acima, os vetores <span class="math inline">\(\hat{\mathbf{i}}\)</span>,<span class="math inline">\(\hat{\mathbf{j}}\)</span>,<span class="math inline">\(\hat{\mathbf{k}}\)</span> correspondem às direções dos eixos <span class="math inline">\(x\)</span>,<span class="math inline">\(y\)</span>,<span class="math inline">\(z\)</span> do espaço euclidiano, e <span class="math inline">\(\hat{\mathbf{u}}\)</span>,<span class="math inline">\(\hat{\mathbf{v}}\)</span>,<span class="math inline">\(\hat{\mathbf{n}}\)</span> são os vetores do frame da câmera. A câmera está localizada em <span class="math inline">\((0, 0.5, 2.5)\)</span> e está olhando na direção do eixo <span class="math inline">\(z\)</span> negativo.</p>
<ul>
<li>O <strong>coelho vermelho</strong> está na posição <span class="math inline">\((0,0,0)\)</span> e tem escala de <span class="math inline">\(10\%\)</span> do tamanho original.</li>
<li>O <strong>coelho cinza</strong> está na posição <span class="math inline">\((-1,0,0)\)</span> e está rodado em <span class="math inline">\(90^{\circ}\)</span> em torno de seu eixo <span class="math inline">\(y\)</span> local.</li>
<li>O <strong>coelho azul</strong> está na posição <span class="math inline">\((1,0,0)\)</span> e está rodado em <span class="math inline">\(-90^{\circ}\)</span> em torno de seu eixo <span class="math inline">\(y\)</span> local.</li>
<li>O <strong>coelho amarelo</strong> está na posição <span class="math inline">\((0,0,-1)\)</span> e está com sua orientação original.</li>
</ul>
<p>A câmera pode ser movida através do teclado:</p>
<ul>
<li>As setas para cima/baixo (ou <code>W</code>/<code>S</code>) fazem a câmera ir para a frente/trás ao longo da direção de visão (direção de <span class="math inline">\(\pm\hat{\mathbf{n}}\)</span>). No jargão da cinematografia, esse movimento de câmera é chamado de <strong>dolly</strong>.</li>
<li>As setas para os lados (ou <code>A</code>/<code>D</code>) fazem a câmera girar em torno de seu eixo <span class="math inline">\(y\)</span> (vetor <span class="math inline">\(\hat{\mathbf{v}}\)</span>). Esse movimento é chamado de <strong>pan</strong>.</li>
<li>As teclas <code>Q</code>/<code>E</code> fazem a câmera deslizar para os lados (direção de <span class="math inline">\(\pm\hat{\mathbf{u}}\)</span>). Esse movimento é chamado de <strong>truck</strong> ou <strong>dolly lateral</strong>.</li>
</ul>
<p>O chão da cena não é renderizado, e os objetos parecem flutuar no espaço. Entretanto, a câmera sempre mantém a mesma altura <span class="math inline">\(y=0.5\)</span>. O resultado é como se o observador estivesse se deslocando sobre um chão invisível.</p>
<p>O resultado ficará como a seguir:</p>
<iframe
  src="https://hbatagelo.github.io/abcgapps/lookat/index.html"
  frameborder="0" allowfullscreen="true" allowtransparency="true" emscriptenheight="735"
  ></iframe>
<div class="infobox">
<svg style="height:1.4em;fill:#555;" viewBox="0 0 512 512">
<path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"/>
</svg>
<div class="infoboxtitle">
Observação
</div>
<p>Para controlar a câmera usando o teclado, abra o <a href="https://hbatagelo.github.io/abcgapps/lookat/index.html">link original</a> e clique na área de desenho para a aplicação ter o foco do teclado.</p>
</div>
<div id="configuração-inicial-6" class="section level3 unnumbered">
<h3>Configuração inicial</h3>
<ul>
<li><p>No arquivo <code>abcg/examples/CMakeLists.txt</code>, inclua a linha:</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode cmake"><code class="sourceCode cmake"><span id="cb227-1"><a href="lookatproject.html#cb227-1"></a><span class="kw">add_subdirectory</span>(lookat)</span></code></pre></div></li>
<li><p>Crie o subdiretório <code>abcg/examples/lookat</code> e o arquivo <code>abcg/examples/lookat/CMakeLists.txt</code> com o seguinte conteúdo:</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode cmake"><code class="sourceCode cmake"><span id="cb228-1"><a href="lookatproject.html#cb228-1"></a><span class="kw">project</span>(lookat)</span>
<span id="cb228-2"><a href="lookatproject.html#cb228-2"></a><span class="kw">add_executable</span>(<span class="dv">${PROJECT_NAME}</span> camera.cpp main.cpp openglwindow.cpp)</span>
<span id="cb228-3"><a href="lookatproject.html#cb228-3"></a><span class="fu">enable_abcg</span>(<span class="dv">${PROJECT_NAME}</span>)</span></code></pre></div></li>
<li><p>Crie os arquivos <code>camera.cpp</code>, <code>camera.hpp</code>, <code>main.cpp</code>, <code>openglwindow.cpp</code> e <code>openglwindow.hpp</code>.</p></li>
<li><p>Crie o subdiretório <code>abcg/examples/lookat/assets</code>. Dentro dele, crie os arquivos <code>lookat.frag</code> e <code>lookat.vert</code>. Além disso, baixe o arquivo <a href="http://professor.ufabc.edu.br/~harlen.batagelo/cg/data/bunny.zip"><code>bunny.zip</code></a> e descompacte-o em <code>assets</code>.</p></li>
</ul>
<p>A estrutura de <code>abcg/examples/lookat</code> ficará assim:</p>
<pre><code>lookat/
│   CMakeLists.txt
│   camera.hpp
│   camera.cpp
│   main.cpp
│   openglwindow.hpp
│   openglwindow.cpp
│
└───assets/
    │   bunny.obj
    │   lookat.frag    
    └   lookat.vert</code></pre>
</div>
<div id="main.cpp-6" class="section level3 unnumbered">
<h3>main.cpp</h3>
<p>O conteúdo de <code>main.cpp</code> é o mesmo do projeto anterior. Só muda o título da janela:</p>
<div class="sourceCode" id="cb230" startFrom="1"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb230-1"><a href="lookatproject.html#cb230-1"></a><span class="pp">#include </span><span class="im">&lt;fmt/core.h&gt;</span></span>
<span id="cb230-2"><a href="lookatproject.html#cb230-2"></a></span>
<span id="cb230-3"><a href="lookatproject.html#cb230-3"></a><span class="pp">#include </span><span class="im">&quot;abcg.hpp&quot;</span></span>
<span id="cb230-4"><a href="lookatproject.html#cb230-4"></a><span class="pp">#include </span><span class="im">&quot;openglwindow.hpp&quot;</span></span>
<span id="cb230-5"><a href="lookatproject.html#cb230-5"></a></span>
<span id="cb230-6"><a href="lookatproject.html#cb230-6"></a><span class="dt">int</span> main(<span class="dt">int</span> argc, <span class="dt">char</span> **argv) {</span>
<span id="cb230-7"><a href="lookatproject.html#cb230-7"></a>  <span class="cf">try</span> {</span>
<span id="cb230-8"><a href="lookatproject.html#cb230-8"></a>    abcg::Application app(argc, argv);</span>
<span id="cb230-9"><a href="lookatproject.html#cb230-9"></a></span>
<span id="cb230-10"><a href="lookatproject.html#cb230-10"></a>    <span class="kw">auto</span> window{<span class="bu">std::</span>make_unique&lt;OpenGLWindow&gt;()};</span>
<span id="cb230-11"><a href="lookatproject.html#cb230-11"></a>    window-&gt;setOpenGLSettings({.samples = <span class="dv">4</span>});</span>
<span id="cb230-12"><a href="lookatproject.html#cb230-12"></a>    window-&gt;setWindowSettings(</span>
<span id="cb230-13"><a href="lookatproject.html#cb230-13"></a>        {.width = <span class="dv">600</span>, .height = <span class="dv">600</span>, .title = <span class="st">&quot;LookAt Camera&quot;</span>});</span>
<span id="cb230-14"><a href="lookatproject.html#cb230-14"></a></span>
<span id="cb230-15"><a href="lookatproject.html#cb230-15"></a>    app.run(window);</span>
<span id="cb230-16"><a href="lookatproject.html#cb230-16"></a>  } <span class="cf">catch</span> (abcg::Exception &amp;exception) {</span>
<span id="cb230-17"><a href="lookatproject.html#cb230-17"></a>    fmt::print(stderr, <span class="st">&quot;{}</span><span class="sc">\n</span><span class="st">&quot;</span>, exception.what());</span>
<span id="cb230-18"><a href="lookatproject.html#cb230-18"></a>    <span class="cf">return</span> -<span class="dv">1</span>;</span>
<span id="cb230-19"><a href="lookatproject.html#cb230-19"></a>  }</span>
<span id="cb230-20"><a href="lookatproject.html#cb230-20"></a>  <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb230-21"><a href="lookatproject.html#cb230-21"></a>}</span></code></pre></div>
</div>
<div id="lookat.vert" class="section level3 unnumbered">
<h3>lookat.vert</h3>
<p>O vertex shader ficará como a seguir:</p>
<div class="sourceCode" id="cb231" startFrom="1"><pre class="sourceCode numberSource glsl numberLines"><code class="sourceCode glsl"><span id="cb231-1"><a href="lookatproject.html#cb231-1"></a><span class="pp">#version 410</span></span>
<span id="cb231-2"><a href="lookatproject.html#cb231-2"></a></span>
<span id="cb231-3"><a href="lookatproject.html#cb231-3"></a><span class="kw">layout</span>(<span class="dt">location</span> = <span class="dv">0</span>) <span class="dt">in</span> <span class="dt">vec3</span> inPosition;</span>
<span id="cb231-4"><a href="lookatproject.html#cb231-4"></a></span>
<span id="cb231-5"><a href="lookatproject.html#cb231-5"></a><span class="kw">uniform</span> <span class="dt">vec4</span> color;</span>
<span id="cb231-6"><a href="lookatproject.html#cb231-6"></a><span class="kw">uniform</span> <span class="dt">mat4</span> modelMatrix;</span>
<span id="cb231-7"><a href="lookatproject.html#cb231-7"></a><span class="kw">uniform</span> <span class="dt">mat4</span> viewMatrix;</span>
<span id="cb231-8"><a href="lookatproject.html#cb231-8"></a><span class="kw">uniform</span> <span class="dt">mat4</span> projMatrix;</span>
<span id="cb231-9"><a href="lookatproject.html#cb231-9"></a></span>
<span id="cb231-10"><a href="lookatproject.html#cb231-10"></a><span class="dt">out</span> <span class="dt">vec4</span> fragColor;</span>
<span id="cb231-11"><a href="lookatproject.html#cb231-11"></a></span>
<span id="cb231-12"><a href="lookatproject.html#cb231-12"></a><span class="dt">void</span> <span class="fu">main</span>() {</span>
<span id="cb231-13"><a href="lookatproject.html#cb231-13"></a>  <span class="dt">vec4</span> posEyeSpace = viewMatrix * modelMatrix * <span class="dt">vec4</span>(inPosition, <span class="dv">1</span>);</span>
<span id="cb231-14"><a href="lookatproject.html#cb231-14"></a></span>
<span id="cb231-15"><a href="lookatproject.html#cb231-15"></a>  <span class="dt">float</span> i = <span class="fl">1.0</span> - (-posEyeSpace.<span class="fu">z</span> / <span class="fl">5.0</span>);</span>
<span id="cb231-16"><a href="lookatproject.html#cb231-16"></a>  fragColor = <span class="dt">vec4</span>(i, i, i, <span class="dv">1</span>) * color;</span>
<span id="cb231-17"><a href="lookatproject.html#cb231-17"></a></span>
<span id="cb231-18"><a href="lookatproject.html#cb231-18"></a>  <span class="bu">gl_Position</span> = projMatrix * posEyeSpace;</span>
<span id="cb231-19"><a href="lookatproject.html#cb231-19"></a>}</span></code></pre></div>
<p>O atributo de entrada, <code>inPosition</code>, é a posição <span class="math inline">\((x,y,z)\)</span> do vértice no <strong>espaço do objeto</strong>.</p>
<p>O atributo de saída, <code>fragColor</code>, é uma cor RGBA.</p>
<p>As variáveis uniformes (linhas 5 a 8) são utilizadas para determinar a cor do objeto (<code>color</code>) e as matrizes <span class="math inline">\(4 \times 4\)</span> de transformação geométrica:</p>
<ul>
<li>Matriz de modelo: <code>modelMatrix</code>;</li>
<li>Matriz de visão: <code>viewMatrix</code>;</li>
<li>Matriz de projeção: <code>projMatrix</code>.</li>
</ul>
<p>Embora ainda não tenha sido abordada a teoria de como criar a matriz de projeção, vamos utilizá-la desde já para obter o efeito de perspectiva necessário para manter a ilusão de que a câmera LookAt é um observador dentro de um cenário 3D.</p>
<p>No código de <code>main</code>, a linha 13 transforma a posição de entrada pelas matrizes de modelo e visão. Para entender a ordem das transformações, temos de ler a linha 13 da direita para a esquerda:</p>
<div class="sourceCode" id="cb232" startFrom="13"><pre class="sourceCode numberSource glsl numberLines"><code class="sourceCode glsl" style="counter-reset: source-line 12;"><span id="cb232-13"><a href="lookatproject.html#cb232-13"></a>  <span class="dt">vec4</span> posEyeSpace = viewMatrix * modelMatrix * <span class="dt">vec4</span>(inPosition, <span class="dv">1</span>);</span></code></pre></div>
<p>Primeiro, <code>vec4(inPosition, 1)</code> produz a posição <span class="math inline">\((x,y,z,1)\)</span>, isto é, um ponto em coordenadas homogêneas. Essa posição é multiplicada (isto é, transformada) pela matriz de modelo <code>modelMatrix</code> para converter as coordenadas do espaço do objeto para o <strong>espaço do mundo</strong>. Em seguida há uma transformação pela matriz de visão <code>viewMatrix</code>, que converte as coordenadas do espaço do mundo para coordenadas do <strong>espaço da câmera</strong>. É esse o resultado armazenado em <code>posEyeSpace</code>: a posição do vértice no espaço da câmera.</p>
<p>Na linha 15, calculamos um valor <code>i</code> de intensidade de cor com base na coordenada <span class="math inline">\(z\)</span> no espaço da câmera:</p>
<div class="sourceCode" id="cb233" startFrom="15"><pre class="sourceCode numberSource glsl numberLines"><code class="sourceCode glsl" style="counter-reset: source-line 14;"><span id="cb233-15"><a href="lookatproject.html#cb233-15"></a>  <span class="dt">float</span> i = <span class="fl">1.0</span> - (-posEyeSpace.<span class="fu">z</span> / <span class="fl">5.0</span>);</span></code></pre></div>
<p>Lembre-se que, no espaço da câmera, a câmera está olhando na direção de seu eixo <span class="math inline">\(z\)</span> negativo. Logo, do ponto de vista da câmera, todos os objetos à sua frente têm valor <span class="math inline">\(z\)</span> negativo. Ao fazer <code>-PosEyeSpace.z</code>, tornamos esse valor positivo, correspondendo à distância entre o ponto e a câmera ao longo do eixo <span class="math inline">\(z\)</span>. A ideia aqui é transformar essa distância em um valor de intensidade de cor. A intensidade será máxima (1) se o objeto estiver na mesma posição da câmera, e mínima (0) se estiver a uma distância de 5 unidades. Na linha 16, esse valor é utilizado para multiplicar as componentes RGB da cor <code>color</code>.</p>
<div class="sourceCode" id="cb234" startFrom="16"><pre class="sourceCode numberSource glsl numberLines"><code class="sourceCode glsl" style="counter-reset: source-line 15;"><span id="cb234-16"><a href="lookatproject.html#cb234-16"></a>  fragColor = <span class="dt">vec4</span>(i, i, i, <span class="dv">1</span>) * color;</span></code></pre></div>
<p>Assim, quanto mais longe o objeto estiver da câmera, mais escuro ele ficará. A partir da distância 5, a intensidade fica negativa, mas nesse caso o OpenGL fixa automaticamente o valor de cor para zero (não existe intensidade negativa de cor).</p>
<p>Na linha 18, <code>projMatrix * posEyeSpace</code> faz com que as coordenadas no espaço da câmera sejam convertidas para o <strong>espaço de recorte</strong>. É esse o resultado final em <code>gl_Position</code>:</p>
<div class="sourceCode" id="cb235" startFrom="18"><pre class="sourceCode numberSource glsl numberLines"><code class="sourceCode glsl" style="counter-reset: source-line 17;"><span id="cb235-18"><a href="lookatproject.html#cb235-18"></a>  <span class="bu">gl_Position</span> = projMatrix * posEyeSpace;</span></code></pre></div>
</div>
<div id="lookat.frag" class="section level3 unnumbered">
<h3>lookat.frag</h3>
<p>O conteúdo do fragment shader ficará assim:</p>
<div class="sourceCode" id="cb236" startFrom="1"><pre class="sourceCode numberSource glsl numberLines"><code class="sourceCode glsl"><span id="cb236-1"><a href="lookatproject.html#cb236-1"></a><span class="pp">#version 410</span></span>
<span id="cb236-2"><a href="lookatproject.html#cb236-2"></a></span>
<span id="cb236-3"><a href="lookatproject.html#cb236-3"></a><span class="dt">in</span> <span class="dt">vec4</span> fragColor;</span>
<span id="cb236-4"><a href="lookatproject.html#cb236-4"></a><span class="dt">out</span> <span class="dt">vec4</span> outColor;</span>
<span id="cb236-5"><a href="lookatproject.html#cb236-5"></a></span>
<span id="cb236-6"><a href="lookatproject.html#cb236-6"></a><span class="dt">void</span> <span class="fu">main</span>() {</span>
<span id="cb236-7"><a href="lookatproject.html#cb236-7"></a>  <span class="kw">if</span> (<span class="bu">gl_FrontFacing</span>) {</span>
<span id="cb236-8"><a href="lookatproject.html#cb236-8"></a>    outColor = fragColor;</span>
<span id="cb236-9"><a href="lookatproject.html#cb236-9"></a>  } <span class="kw">else</span> {</span>
<span id="cb236-10"><a href="lookatproject.html#cb236-10"></a>    outColor = fragColor * <span class="fl">0.5</span>;</span>
<span id="cb236-11"><a href="lookatproject.html#cb236-11"></a>  }</span>
<span id="cb236-12"><a href="lookatproject.html#cb236-12"></a>}</span></code></pre></div>
<p>Se o triângulo estiver orientado de frente para a câmera, a cor final do fragmento será a cor de entrada (<code>fragColor</code>). Caso contrário, a cor terá metade da intensidade original. Assim, se a câmera estiver dentro de um objeto, os triângulos serão desenhados com uma cor mais escura, pois estaremos vendo o lado de trás da malha triangular.</p>
</div>
<div id="camera.hpp" class="section level3 unnumbered">
<h3>camera.hpp</h3>
<p>Neste arquivo definiremos a classe <code>Camera</code> que gerenciará a câmera LookAt. O conteúdo ficará assim:</p>
<div class="sourceCode" id="cb237" startFrom="1"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb237-1"><a href="lookatproject.html#cb237-1"></a><span class="pp">#ifndef CAMERA_HPP_</span></span>
<span id="cb237-2"><a href="lookatproject.html#cb237-2"></a><span class="pp">#define CAMERA_HPP_</span></span>
<span id="cb237-3"><a href="lookatproject.html#cb237-3"></a></span>
<span id="cb237-4"><a href="lookatproject.html#cb237-4"></a><span class="pp">#include </span><span class="im">&lt;glm/mat4x4.hpp&gt;</span></span>
<span id="cb237-5"><a href="lookatproject.html#cb237-5"></a><span class="pp">#include </span><span class="im">&lt;glm/vec3.hpp&gt;</span></span>
<span id="cb237-6"><a href="lookatproject.html#cb237-6"></a></span>
<span id="cb237-7"><a href="lookatproject.html#cb237-7"></a><span class="kw">class</span> OpenGLWindow;</span>
<span id="cb237-8"><a href="lookatproject.html#cb237-8"></a></span>
<span id="cb237-9"><a href="lookatproject.html#cb237-9"></a><span class="kw">class</span> Camera {</span>
<span id="cb237-10"><a href="lookatproject.html#cb237-10"></a> <span class="kw">public</span>:</span>
<span id="cb237-11"><a href="lookatproject.html#cb237-11"></a>  <span class="dt">void</span> computeViewMatrix();</span>
<span id="cb237-12"><a href="lookatproject.html#cb237-12"></a>  <span class="dt">void</span> computeProjectionMatrix(<span class="dt">int</span> width, <span class="dt">int</span> height);</span>
<span id="cb237-13"><a href="lookatproject.html#cb237-13"></a></span>
<span id="cb237-14"><a href="lookatproject.html#cb237-14"></a>  <span class="dt">void</span> dolly(<span class="dt">float</span> speed);</span>
<span id="cb237-15"><a href="lookatproject.html#cb237-15"></a>  <span class="dt">void</span> truck(<span class="dt">float</span> speed);</span>
<span id="cb237-16"><a href="lookatproject.html#cb237-16"></a>  <span class="dt">void</span> pan(<span class="dt">float</span> speed);</span>
<span id="cb237-17"><a href="lookatproject.html#cb237-17"></a></span>
<span id="cb237-18"><a href="lookatproject.html#cb237-18"></a> <span class="kw">private</span>:</span>
<span id="cb237-19"><a href="lookatproject.html#cb237-19"></a>  <span class="kw">friend</span> OpenGLWindow;</span>
<span id="cb237-20"><a href="lookatproject.html#cb237-20"></a></span>
<span id="cb237-21"><a href="lookatproject.html#cb237-21"></a>  glm::vec3 <span class="va">m_eye</span>{glm::vec3(<span class="fl">0.0</span><span class="bu">f</span>, <span class="fl">0.5</span><span class="bu">f</span>, <span class="fl">2.5</span><span class="bu">f</span>)};  <span class="co">// Camera position</span></span>
<span id="cb237-22"><a href="lookatproject.html#cb237-22"></a>  glm::vec3 <span class="va">m_at</span>{glm::vec3(<span class="fl">0.0</span><span class="bu">f</span>, <span class="fl">0.5</span><span class="bu">f</span>, <span class="fl">0.0</span><span class="bu">f</span>)};   <span class="co">// Look-at point</span></span>
<span id="cb237-23"><a href="lookatproject.html#cb237-23"></a>  glm::vec3 <span class="va">m_up</span>{glm::vec3(<span class="fl">0.0</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">0.0</span><span class="bu">f</span>)};   <span class="co">// &quot;up&quot; direction</span></span>
<span id="cb237-24"><a href="lookatproject.html#cb237-24"></a></span>
<span id="cb237-25"><a href="lookatproject.html#cb237-25"></a>  <span class="co">// Matrix to change from world space to camera soace</span></span>
<span id="cb237-26"><a href="lookatproject.html#cb237-26"></a>  glm::mat4 <span class="va">m_viewMatrix</span>;</span>
<span id="cb237-27"><a href="lookatproject.html#cb237-27"></a></span>
<span id="cb237-28"><a href="lookatproject.html#cb237-28"></a>  <span class="co">// Matrix to change from camera space to clip space</span></span>
<span id="cb237-29"><a href="lookatproject.html#cb237-29"></a>  glm::mat4 <span class="va">m_projMatrix</span>;</span>
<span id="cb237-30"><a href="lookatproject.html#cb237-30"></a>};</span>
<span id="cb237-31"><a href="lookatproject.html#cb237-31"></a></span>
<span id="cb237-32"><a href="lookatproject.html#cb237-32"></a><span class="pp">#endif</span></span></code></pre></div>
<p>Observe, nas linhas 21 a 23, que a classe tem os atributos necessários para criar o frame de uma câmera LookAt:</p>
<ul>
<li><code>m_eye</code> é a posição da câmera: <span class="math inline">\((0, 0.5, 2.5)\)</span>.</li>
<li><code>m_at</code> é a posição para onde a câmera está olhando: <span class="math inline">\((0, 0.5, 0)\)</span>.</li>
<li><code>m_up</code> é o vetor de direção para cima: <span class="math inline">\((0, 1, 0)\)</span>.</li>
</ul>
<p>Na linha 26 temos a matriz de visão (<code>m_viewMatrix</code>), calculada pelo método <code>Camera::computeViewMatrix</code> (linha 11).</p>
<p>Na linha 29 temos a matriz de projeção (<code>m_projMatrix</code>), calculada pelo método <code>Camera::computeProjectionMatrix</code> (linha 12).</p>
<p>Os métodos <code>Camera::dolly</code>, <code>Camera::truck</code> e <code>Camera::pan</code> serão chamados a partir de <code>OpenGLWindow</code>, em resposta à entrada do teclado. Internamente, esses métodos modificarão as variáveis <code>m_eye</code> e <code>m_at</code>, fazendo a câmera mudar de posição e orientação.</p>
</div>
<div id="camera.cpp" class="section level3 unnumbered">
<h3>camera.cpp</h3>
<p>A definição dos métodos de <code>Camera</code> ficará como a seguir:</p>
<div class="sourceCode" id="cb238" startFrom="1"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb238-1"><a href="lookatproject.html#cb238-1"></a><span class="pp">#include </span><span class="im">&quot;camera.hpp&quot;</span></span>
<span id="cb238-2"><a href="lookatproject.html#cb238-2"></a></span>
<span id="cb238-3"><a href="lookatproject.html#cb238-3"></a><span class="pp">#include </span><span class="im">&lt;glm/gtc/matrix_transform.hpp&gt;</span></span>
<span id="cb238-4"><a href="lookatproject.html#cb238-4"></a></span>
<span id="cb238-5"><a href="lookatproject.html#cb238-5"></a><span class="dt">void</span> Camera::computeProjectionMatrix(<span class="dt">int</span> width, <span class="dt">int</span> height) {</span>
<span id="cb238-6"><a href="lookatproject.html#cb238-6"></a>  <span class="va">m_projMatrix</span> = glm::mat4(<span class="fl">1.0</span><span class="bu">f</span>);</span>
<span id="cb238-7"><a href="lookatproject.html#cb238-7"></a>  <span class="kw">auto</span> aspect{<span class="kw">static_cast</span>&lt;<span class="dt">float</span>&gt;(width) / <span class="kw">static_cast</span>&lt;<span class="dt">float</span>&gt;(height)};</span>
<span id="cb238-8"><a href="lookatproject.html#cb238-8"></a>  <span class="va">m_projMatrix</span> = glm::perspective(glm::radians(<span class="fl">70.0</span><span class="bu">f</span>), aspect, <span class="fl">0.1</span><span class="bu">f</span>, <span class="fl">5.0</span><span class="bu">f</span>);</span>
<span id="cb238-9"><a href="lookatproject.html#cb238-9"></a>}</span>
<span id="cb238-10"><a href="lookatproject.html#cb238-10"></a></span>
<span id="cb238-11"><a href="lookatproject.html#cb238-11"></a><span class="dt">void</span> Camera::computeViewMatrix() {</span>
<span id="cb238-12"><a href="lookatproject.html#cb238-12"></a>  <span class="va">m_viewMatrix</span> = glm::lookAt(<span class="va">m_eye</span>, <span class="va">m_at</span>, <span class="va">m_up</span>);</span>
<span id="cb238-13"><a href="lookatproject.html#cb238-13"></a>}</span>
<span id="cb238-14"><a href="lookatproject.html#cb238-14"></a></span>
<span id="cb238-15"><a href="lookatproject.html#cb238-15"></a><span class="dt">void</span> Camera::dolly(<span class="dt">float</span> speed) {</span>
<span id="cb238-16"><a href="lookatproject.html#cb238-16"></a>  <span class="co">// Compute forward vector (view direction)</span></span>
<span id="cb238-17"><a href="lookatproject.html#cb238-17"></a>  glm::vec3 forward = glm::normalize(<span class="va">m_at</span> - <span class="va">m_eye</span>);</span>
<span id="cb238-18"><a href="lookatproject.html#cb238-18"></a></span>
<span id="cb238-19"><a href="lookatproject.html#cb238-19"></a>  <span class="co">// Move eye and center forward (speed &gt; 0) or backward (speed &lt; 0)</span></span>
<span id="cb238-20"><a href="lookatproject.html#cb238-20"></a>  <span class="va">m_eye</span> += forward * speed;</span>
<span id="cb238-21"><a href="lookatproject.html#cb238-21"></a>  <span class="va">m_at</span> += forward * speed;</span>
<span id="cb238-22"><a href="lookatproject.html#cb238-22"></a></span>
<span id="cb238-23"><a href="lookatproject.html#cb238-23"></a>  computeViewMatrix();</span>
<span id="cb238-24"><a href="lookatproject.html#cb238-24"></a>}</span>
<span id="cb238-25"><a href="lookatproject.html#cb238-25"></a></span>
<span id="cb238-26"><a href="lookatproject.html#cb238-26"></a><span class="dt">void</span> Camera::truck(<span class="dt">float</span> speed) {</span>
<span id="cb238-27"><a href="lookatproject.html#cb238-27"></a>  <span class="co">// Compute forward vector (view direction)</span></span>
<span id="cb238-28"><a href="lookatproject.html#cb238-28"></a>  glm::vec3 forward = glm::normalize(<span class="va">m_at</span> - <span class="va">m_eye</span>);</span>
<span id="cb238-29"><a href="lookatproject.html#cb238-29"></a>  <span class="co">// Compute vector to the left</span></span>
<span id="cb238-30"><a href="lookatproject.html#cb238-30"></a>  glm::vec3 left = glm::cross(<span class="va">m_up</span>, forward);</span>
<span id="cb238-31"><a href="lookatproject.html#cb238-31"></a></span>
<span id="cb238-32"><a href="lookatproject.html#cb238-32"></a>  <span class="co">// Move eye and center to the left (speed &lt; 0) or to the right (speed &gt; 0)</span></span>
<span id="cb238-33"><a href="lookatproject.html#cb238-33"></a>  <span class="va">m_at</span> -= left * speed;</span>
<span id="cb238-34"><a href="lookatproject.html#cb238-34"></a>  <span class="va">m_eye</span> -= left * speed;</span>
<span id="cb238-35"><a href="lookatproject.html#cb238-35"></a></span>
<span id="cb238-36"><a href="lookatproject.html#cb238-36"></a>  computeViewMatrix();</span>
<span id="cb238-37"><a href="lookatproject.html#cb238-37"></a>}</span>
<span id="cb238-38"><a href="lookatproject.html#cb238-38"></a></span>
<span id="cb238-39"><a href="lookatproject.html#cb238-39"></a><span class="dt">void</span> Camera::pan(<span class="dt">float</span> speed) {</span>
<span id="cb238-40"><a href="lookatproject.html#cb238-40"></a>  glm::mat4 transform{glm::mat4(<span class="fl">1.0</span><span class="bu">f</span>)};</span>
<span id="cb238-41"><a href="lookatproject.html#cb238-41"></a></span>
<span id="cb238-42"><a href="lookatproject.html#cb238-42"></a>  <span class="co">// Rotate camera around its local y axis</span></span>
<span id="cb238-43"><a href="lookatproject.html#cb238-43"></a>  transform = glm::translate(transform, <span class="va">m_eye</span>);</span>
<span id="cb238-44"><a href="lookatproject.html#cb238-44"></a>  transform = glm::rotate(transform, -speed, <span class="va">m_up</span>);</span>
<span id="cb238-45"><a href="lookatproject.html#cb238-45"></a>  transform = glm::translate(transform, -<span class="va">m_eye</span>);</span>
<span id="cb238-46"><a href="lookatproject.html#cb238-46"></a></span>
<span id="cb238-47"><a href="lookatproject.html#cb238-47"></a>  <span class="va">m_at</span> = transform * glm::vec4(<span class="va">m_at</span>, <span class="fl">1.0</span><span class="bu">f</span>);</span>
<span id="cb238-48"><a href="lookatproject.html#cb238-48"></a></span>
<span id="cb238-49"><a href="lookatproject.html#cb238-49"></a>  computeViewMatrix();</span>
<span id="cb238-50"><a href="lookatproject.html#cb238-50"></a>}</span></code></pre></div>
<p>Por enquanto vamos ignorar a definição do método <code>Camera::computeProjectionMatrix</code>. Retomaremos no próximo capítulo quando tivermos visto a teoria sobre matrizes de projeção.</p>
<p>Em <code>Camera::computeViewMatrix</code>, chamamos a função <code>lookAt</code> da GLM usando os atributos da câmera:</p>
<div class="sourceCode" id="cb239" startFrom="11"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 10;"><span id="cb239-11"><a href="lookatproject.html#cb239-11"></a><span class="dt">void</span> Camera::computeViewMatrix() {</span>
<span id="cb239-12"><a href="lookatproject.html#cb239-12"></a>  <span class="va">m_viewMatrix</span> = glm::lookAt(<span class="va">m_eye</span>, <span class="va">m_at</span>, <span class="va">m_up</span>);</span>
<span id="cb239-13"><a href="lookatproject.html#cb239-13"></a>}</span></code></pre></div>
<p>Esse método será chamado sempre que houver alguma alteração em <code>m_eye</code> ou <code>m_at</code>.</p>
<p>Em <code>Camera::dolly</code>, os pontos <code>m_eye</code> e <code>m_at</code> são movidos para a frente ou para trás na direção de visão (vetor <code>forward</code>):</p>
<div class="sourceCode" id="cb240" startFrom="15"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 14;"><span id="cb240-15"><a href="lookatproject.html#cb240-15"></a><span class="dt">void</span> Camera::dolly(<span class="dt">float</span> speed) {</span>
<span id="cb240-16"><a href="lookatproject.html#cb240-16"></a>  <span class="co">// Compute forward vector (view direction)</span></span>
<span id="cb240-17"><a href="lookatproject.html#cb240-17"></a>  glm::vec3 forward = glm::normalize(<span class="va">m_at</span> - <span class="va">m_eye</span>);</span>
<span id="cb240-18"><a href="lookatproject.html#cb240-18"></a></span>
<span id="cb240-19"><a href="lookatproject.html#cb240-19"></a>  <span class="co">// Move eye and center forward (speed &gt; 0) or backward (speed &lt; 0)</span></span>
<span id="cb240-20"><a href="lookatproject.html#cb240-20"></a>  <span class="va">m_eye</span> += forward * speed;</span>
<span id="cb240-21"><a href="lookatproject.html#cb240-21"></a>  <span class="va">m_at</span> += forward * speed;</span>
<span id="cb240-22"><a href="lookatproject.html#cb240-22"></a></span>
<span id="cb240-23"><a href="lookatproject.html#cb240-23"></a>  computeViewMatrix();</span>
<span id="cb240-24"><a href="lookatproject.html#cb240-24"></a>}</span></code></pre></div>
<p>Veja que, ao final, <code>Camera::computeViewMatrix</code> é chamado para reconstruir a matriz de visão.</p>
<p><code>Camera::truck</code> funciona de forma parecida ao <code>Camera::dolly</code>. Os pontos <code>m_eye</code> e <code>m_at</code> são movidos para os lados na direção do vetor <code>left</code>, que é o produto vetorial entre o vetor <code>up</code> e o vetor <code>forward</code>.</p>
<div class="sourceCode" id="cb241" startFrom="26"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 25;"><span id="cb241-26"><a href="lookatproject.html#cb241-26"></a><span class="dt">void</span> Camera::truck(<span class="dt">float</span> speed) {</span>
<span id="cb241-27"><a href="lookatproject.html#cb241-27"></a>  <span class="co">// Compute forward vector (view direction)</span></span>
<span id="cb241-28"><a href="lookatproject.html#cb241-28"></a>  glm::vec3 forward = glm::normalize(<span class="va">m_at</span> - <span class="va">m_eye</span>);</span>
<span id="cb241-29"><a href="lookatproject.html#cb241-29"></a>  <span class="co">// Compute vector to the left</span></span>
<span id="cb241-30"><a href="lookatproject.html#cb241-30"></a>  glm::vec3 left = glm::cross(<span class="va">m_up</span>, forward);</span>
<span id="cb241-31"><a href="lookatproject.html#cb241-31"></a></span>
<span id="cb241-32"><a href="lookatproject.html#cb241-32"></a>  <span class="co">// Move eye and center to the left (speed &lt; 0) or to the right (speed &gt; 0)</span></span>
<span id="cb241-33"><a href="lookatproject.html#cb241-33"></a>  <span class="va">m_at</span> -= left * speed;</span>
<span id="cb241-34"><a href="lookatproject.html#cb241-34"></a>  <span class="va">m_eye</span> -= left * speed;</span>
<span id="cb241-35"><a href="lookatproject.html#cb241-35"></a></span>
<span id="cb241-36"><a href="lookatproject.html#cb241-36"></a>  computeViewMatrix();</span>
<span id="cb241-37"><a href="lookatproject.html#cb241-37"></a>}</span></code></pre></div>
<p><code>Camera::pan</code> faz o movimento de rodar a câmera em torno de seu eixo <span class="math inline">\(y\)</span>. Isso é feito alterando apenas o ponto <code>m_at</code>:</p>
<div class="sourceCode" id="cb242" startFrom="39"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 38;"><span id="cb242-39"><a href="lookatproject.html#cb242-39"></a><span class="dt">void</span> Camera::pan(<span class="dt">float</span> speed) {</span>
<span id="cb242-40"><a href="lookatproject.html#cb242-40"></a>  glm::mat4 transform{glm::mat4(<span class="fl">1.0</span><span class="bu">f</span>)};</span>
<span id="cb242-41"><a href="lookatproject.html#cb242-41"></a></span>
<span id="cb242-42"><a href="lookatproject.html#cb242-42"></a>  <span class="co">// Rotate camera around its local y axis</span></span>
<span id="cb242-43"><a href="lookatproject.html#cb242-43"></a>  transform = glm::translate(transform, <span class="va">m_eye</span>);</span>
<span id="cb242-44"><a href="lookatproject.html#cb242-44"></a>  transform = glm::rotate(transform, -speed, <span class="va">m_up</span>);</span>
<span id="cb242-45"><a href="lookatproject.html#cb242-45"></a>  transform = glm::translate(transform, -<span class="va">m_eye</span>);</span>
<span id="cb242-46"><a href="lookatproject.html#cb242-46"></a></span>
<span id="cb242-47"><a href="lookatproject.html#cb242-47"></a>  <span class="va">m_at</span> = transform * glm::vec4(<span class="va">m_at</span>, <span class="fl">1.0</span><span class="bu">f</span>);</span>
<span id="cb242-48"><a href="lookatproject.html#cb242-48"></a></span>
<span id="cb242-49"><a href="lookatproject.html#cb242-49"></a>  computeViewMatrix();</span>
<span id="cb242-50"><a href="lookatproject.html#cb242-50"></a>}</span></code></pre></div>
<p>A matriz <code>transform</code> é uma concatenção de transformações na forma:</p>
<p><span class="math display">\[
\mathbf{M}=\mathbf{I}.\mathbf{T}(\mathbf{p}_{\textrm{eye}}).\mathbf{R}_y(\theta).\mathbf{T}(-\mathbf{p}_{\textrm{eye}}).
\]</span></p>
<p>A ordem de aplicação das transformações é obtida lendo a expressão da direita para a esquerda (no código, lemos de baixo para cima, da linha 45 à linha 40):</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(\mathbf{T}(-\mathbf{p}_{\textrm{eye}})\)</span> (linha 45) tem o efeito de transladar a câmera para a origem do mundo, isto é, faz o ponto <span class="math inline">\(\mathbf{p}_{\textrm{eye}}\)</span> virar a origem <span class="math inline">\(O\)</span>.</li>
<li><span class="math inline">\(\mathbf{R}_y(\theta)\)</span> (linha 44) roda a câmera em torno do eixo <span class="math inline">\(y\)</span> do mundo. Como a câmera agora está na origem, é como se a câmera fosse rodada em torno de seu próprio eixo <span class="math inline">\(y\)</span>.</li>
<li><span class="math inline">\(\mathbf{T}(\mathbf{p}_{\textrm{eye}})\)</span> (linha 43) é a transformação inversa da primeira, e faz a câmera voltar à sua posição original.</li>
<li><span class="math inline">\(\mathbf{I}\)</span> é a matriz identidade criada na linha 40.</li>
</ol>
<p>A linha 47 transforma <code>m_at</code> por <code>transform</code>. O resultado é rodar <code>m_at</code> em torno de <code>m_eye</code>.</p>
<div class="infobox">
<svg style="height:1.4em;fill:#555;" viewBox="0 0 512 512">
<path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"/>
</svg>
<div class="infoboxtitle">
Observação
</div>
<p>As operações da linha 40 até a linha 45 em <code>Camera::pan</code> são equivalentes ao pseudocódigo:</p>
<pre><code>transform = I;
transform = transform * T(m_eye);
transform = transform * Ry(-speed);
transform = transform * T(-m_eye);</code></pre>
<p>que é o mesmo que</p>
<pre><code>transform = I * T(m_eye) * Ry(-speed) * T(-m_eye);</code></pre>
<p>onde <code>I</code>, <code>Ry</code> e <code>T</code> são as matrizes de transformação identidade, rotação em <span class="math inline">\(y\)</span>, e translação.</p>
</div>
</div>
<div id="openglwindow.hpp-6" class="section level3 unnumbered">
<h3>openglwindow.hpp</h3>
<p>A definição da classe <code>OpenGLWindow</code> ficará assim:</p>
<div class="sourceCode" id="cb245" startFrom="1"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb245-1"><a href="lookatproject.html#cb245-1"></a><span class="pp">#ifndef OPENGLWINDOW_HPP_</span></span>
<span id="cb245-2"><a href="lookatproject.html#cb245-2"></a><span class="pp">#define OPENGLWINDOW_HPP_</span></span>
<span id="cb245-3"><a href="lookatproject.html#cb245-3"></a></span>
<span id="cb245-4"><a href="lookatproject.html#cb245-4"></a><span class="pp">#include </span><span class="im">&quot;abcg.hpp&quot;</span></span>
<span id="cb245-5"><a href="lookatproject.html#cb245-5"></a><span class="pp">#include </span><span class="im">&quot;camera.hpp&quot;</span></span>
<span id="cb245-6"><a href="lookatproject.html#cb245-6"></a></span>
<span id="cb245-7"><a href="lookatproject.html#cb245-7"></a><span class="kw">struct</span> Vertex {</span>
<span id="cb245-8"><a href="lookatproject.html#cb245-8"></a>  glm::vec3 position;</span>
<span id="cb245-9"><a href="lookatproject.html#cb245-9"></a></span>
<span id="cb245-10"><a href="lookatproject.html#cb245-10"></a>  <span class="dt">bool</span> <span class="kw">operator</span>==(<span class="at">const</span> Vertex&amp; other) <span class="at">const</span> {</span>
<span id="cb245-11"><a href="lookatproject.html#cb245-11"></a>    <span class="cf">return</span> position == other.position;</span>
<span id="cb245-12"><a href="lookatproject.html#cb245-12"></a>  }</span>
<span id="cb245-13"><a href="lookatproject.html#cb245-13"></a>};</span>
<span id="cb245-14"><a href="lookatproject.html#cb245-14"></a></span>
<span id="cb245-15"><a href="lookatproject.html#cb245-15"></a><span class="kw">class</span> OpenGLWindow : <span class="kw">public</span> abcg::OpenGLWindow {</span>
<span id="cb245-16"><a href="lookatproject.html#cb245-16"></a> <span class="kw">protected</span>:</span>
<span id="cb245-17"><a href="lookatproject.html#cb245-17"></a>  <span class="dt">void</span> handleEvent(SDL_Event&amp; ev) <span class="kw">override</span>;</span>
<span id="cb245-18"><a href="lookatproject.html#cb245-18"></a>  <span class="dt">void</span> initializeGL() <span class="kw">override</span>;</span>
<span id="cb245-19"><a href="lookatproject.html#cb245-19"></a>  <span class="dt">void</span> paintGL() <span class="kw">override</span>;</span>
<span id="cb245-20"><a href="lookatproject.html#cb245-20"></a>  <span class="dt">void</span> paintUI() <span class="kw">override</span>;</span>
<span id="cb245-21"><a href="lookatproject.html#cb245-21"></a>  <span class="dt">void</span> resizeGL(<span class="dt">int</span> width, <span class="dt">int</span> height) <span class="kw">override</span>;</span>
<span id="cb245-22"><a href="lookatproject.html#cb245-22"></a>  <span class="dt">void</span> terminateGL() <span class="kw">override</span>;</span>
<span id="cb245-23"><a href="lookatproject.html#cb245-23"></a></span>
<span id="cb245-24"><a href="lookatproject.html#cb245-24"></a> <span class="kw">private</span>:</span>
<span id="cb245-25"><a href="lookatproject.html#cb245-25"></a>  GLuint <span class="va">m_VAO</span>{};</span>
<span id="cb245-26"><a href="lookatproject.html#cb245-26"></a>  GLuint <span class="va">m_VBO</span>{};</span>
<span id="cb245-27"><a href="lookatproject.html#cb245-27"></a>  GLuint <span class="va">m_EBO</span>{};</span>
<span id="cb245-28"><a href="lookatproject.html#cb245-28"></a>  GLuint <span class="va">m_program</span>{};</span>
<span id="cb245-29"><a href="lookatproject.html#cb245-29"></a></span>
<span id="cb245-30"><a href="lookatproject.html#cb245-30"></a>  <span class="dt">int</span> <span class="va">m_viewportWidth</span>{};</span>
<span id="cb245-31"><a href="lookatproject.html#cb245-31"></a>  <span class="dt">int</span> <span class="va">m_viewportHeight</span>{};</span>
<span id="cb245-32"><a href="lookatproject.html#cb245-32"></a></span>
<span id="cb245-33"><a href="lookatproject.html#cb245-33"></a>  Camera <span class="va">m_camera</span>;</span>
<span id="cb245-34"><a href="lookatproject.html#cb245-34"></a>  <span class="dt">float</span> <span class="va">m_dollySpeed</span>{<span class="fl">0.0</span><span class="bu">f</span>};</span>
<span id="cb245-35"><a href="lookatproject.html#cb245-35"></a>  <span class="dt">float</span> <span class="va">m_truckSpeed</span>{<span class="fl">0.0</span><span class="bu">f</span>};</span>
<span id="cb245-36"><a href="lookatproject.html#cb245-36"></a>  <span class="dt">float</span> <span class="va">m_panSpeed</span>{<span class="fl">0.0</span><span class="bu">f</span>};</span>
<span id="cb245-37"><a href="lookatproject.html#cb245-37"></a></span>
<span id="cb245-38"><a href="lookatproject.html#cb245-38"></a>  <span class="bu">std::</span>vector&lt;Vertex&gt; <span class="va">m_vertices</span>;</span>
<span id="cb245-39"><a href="lookatproject.html#cb245-39"></a>  <span class="bu">std::</span>vector&lt;GLuint&gt; <span class="va">m_indices</span>;</span>
<span id="cb245-40"><a href="lookatproject.html#cb245-40"></a></span>
<span id="cb245-41"><a href="lookatproject.html#cb245-41"></a>  <span class="dt">void</span> loadModelFromFile(<span class="bu">std::</span>string_view path);</span>
<span id="cb245-42"><a href="lookatproject.html#cb245-42"></a>  <span class="dt">void</span> update();</span>
<span id="cb245-43"><a href="lookatproject.html#cb245-43"></a>};</span>
<span id="cb245-44"><a href="lookatproject.html#cb245-44"></a></span>
<span id="cb245-45"><a href="lookatproject.html#cb245-45"></a><span class="pp">#endif</span></span></code></pre></div>
<p>Primeiro, observe a estrutura <code>Vertex</code> definida nas linhas 8 a 14:</p>
<div class="sourceCode" id="cb246" startFrom="8"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 7;"><span id="cb246-8"><a href="lookatproject.html#cb246-8"></a><span class="kw">struct</span> Vertex {</span>
<span id="cb246-9"><a href="lookatproject.html#cb246-9"></a>  glm::vec3 position;</span>
<span id="cb246-10"><a href="lookatproject.html#cb246-10"></a></span>
<span id="cb246-11"><a href="lookatproject.html#cb246-11"></a>  <span class="dt">bool</span> <span class="kw">operator</span>==(<span class="at">const</span> Vertex&amp; other) <span class="at">const</span> {</span>
<span id="cb246-12"><a href="lookatproject.html#cb246-12"></a>    <span class="cf">return</span> position == other.position;</span>
<span id="cb246-13"><a href="lookatproject.html#cb246-13"></a>  }</span>
<span id="cb246-14"><a href="lookatproject.html#cb246-14"></a>};</span></code></pre></div>
<p>O código é semelhante ao do projeto <code>loadmodel</code>. As diferenças são:</p>
<ul>
<li>Linha 5: inclusão do cabeçalho <code>camera.hpp</code>;</li>
<li>Linha 17: declaração do método <code>handleEvent</code>, para tratar os eventos do teclado;</li>
<li>Linha 33: definição da instância de <code>Camera</code>;</li>
<li>Linhas 34 a 36: definição de variáveis de controle de velocidade de dolly, truck e pan;</li>
<li>Linha 42: definição de um método <code>update</code> que será chamado em <code>paintGL</code>.</li>
</ul>
<p>Algumas coisas foram removidas em relação ao projeto anterior, como a variável que controlava o número de triângulos exibidos. Também deixamos de usar o método <code>OpenGLWindow::standardize</code>, que normalizava e centralizava o modelo no NDC. Dessa vez, o modelo armazenado no VBO será o modelo sem modificações, isto é, o modelo lido diretamente do arquivo. Para mudar a escala e posição do modelo, usaremos a matriz de modelo.</p>
</div>
<div id="openglwindow.cpp-6" class="section level3 unnumbered">
<h3>openglwindow.cpp</h3>
<p>O início de <code>openglwindow.cpp</code> é exatamente o mesmo do projeto anterior:</p>
<div class="sourceCode" id="cb247" startFrom="1"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb247-1"><a href="lookatproject.html#cb247-1"></a><span class="pp">#include </span><span class="im">&quot;openglwindow.hpp&quot;</span></span>
<span id="cb247-2"><a href="lookatproject.html#cb247-2"></a></span>
<span id="cb247-3"><a href="lookatproject.html#cb247-3"></a><span class="pp">#include </span><span class="im">&lt;fmt/core.h&gt;</span></span>
<span id="cb247-4"><a href="lookatproject.html#cb247-4"></a><span class="pp">#include </span><span class="im">&lt;imgui.h&gt;</span></span>
<span id="cb247-5"><a href="lookatproject.html#cb247-5"></a><span class="pp">#include </span><span class="im">&lt;tiny_obj_loader.h&gt;</span></span>
<span id="cb247-6"><a href="lookatproject.html#cb247-6"></a></span>
<span id="cb247-7"><a href="lookatproject.html#cb247-7"></a><span class="pp">#include </span><span class="im">&lt;cppitertools/itertools.hpp&gt;</span></span>
<span id="cb247-8"><a href="lookatproject.html#cb247-8"></a><span class="pp">#include </span><span class="im">&lt;glm/gtx/fast_trigonometry.hpp&gt;</span></span>
<span id="cb247-9"><a href="lookatproject.html#cb247-9"></a><span class="pp">#include </span><span class="im">&lt;glm/gtx/hash.hpp&gt;</span></span>
<span id="cb247-10"><a href="lookatproject.html#cb247-10"></a><span class="pp">#include </span><span class="im">&lt;unordered_map&gt;</span></span>
<span id="cb247-11"><a href="lookatproject.html#cb247-11"></a></span>
<span id="cb247-12"><a href="lookatproject.html#cb247-12"></a><span class="co">// Custom specialization of std::hash injected in namespace std</span></span>
<span id="cb247-13"><a href="lookatproject.html#cb247-13"></a><span class="kw">namespace</span> std {</span>
<span id="cb247-14"><a href="lookatproject.html#cb247-14"></a><span class="kw">template</span> &lt;&gt;</span>
<span id="cb247-15"><a href="lookatproject.html#cb247-15"></a><span class="kw">struct</span> hash&lt;Vertex&gt; {</span>
<span id="cb247-16"><a href="lookatproject.html#cb247-16"></a>  <span class="dt">size_t</span> <span class="kw">operator</span>()(Vertex <span class="at">const</span>&amp; vertex) <span class="at">const</span> <span class="kw">noexcept</span> {</span>
<span id="cb247-17"><a href="lookatproject.html#cb247-17"></a>    <span class="bu">std::</span>size_t h1{<span class="bu">std::</span>hash&lt;glm::vec3&gt;()(vertex.position)};</span>
<span id="cb247-18"><a href="lookatproject.html#cb247-18"></a>    <span class="cf">return</span> h1;</span>
<span id="cb247-19"><a href="lookatproject.html#cb247-19"></a>  }</span>
<span id="cb247-20"><a href="lookatproject.html#cb247-20"></a>};</span>
<span id="cb247-21"><a href="lookatproject.html#cb247-21"></a>}  <span class="co">// namespace std</span></span></code></pre></div>
<p>A definição de <code>OpenGLWindow::handleEvent</code> vem a seguir:</p>
<div class="sourceCode" id="cb248" startFrom="23"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 22;"><span id="cb248-23"><a href="lookatproject.html#cb248-23"></a><span class="dt">void</span> OpenGLWindow::handleEvent(SDL_Event&amp; ev) {</span>
<span id="cb248-24"><a href="lookatproject.html#cb248-24"></a>  <span class="cf">if</span> (ev.type == SDL_KEYDOWN) {</span>
<span id="cb248-25"><a href="lookatproject.html#cb248-25"></a>    <span class="cf">if</span> (ev.key.keysym.sym == SDLK_UP || ev.key.keysym.sym == SDLK_w)</span>
<span id="cb248-26"><a href="lookatproject.html#cb248-26"></a>      <span class="va">m_dollySpeed</span> = <span class="fl">1.0</span><span class="bu">f</span>;</span>
<span id="cb248-27"><a href="lookatproject.html#cb248-27"></a>    <span class="cf">if</span> (ev.key.keysym.sym == SDLK_DOWN || ev.key.keysym.sym == SDLK_s)</span>
<span id="cb248-28"><a href="lookatproject.html#cb248-28"></a>      <span class="va">m_dollySpeed</span> = -<span class="fl">1.0</span><span class="bu">f</span>;</span>
<span id="cb248-29"><a href="lookatproject.html#cb248-29"></a>    <span class="cf">if</span> (ev.key.keysym.sym == SDLK_LEFT || ev.key.keysym.sym == SDLK_a)</span>
<span id="cb248-30"><a href="lookatproject.html#cb248-30"></a>      <span class="va">m_panSpeed</span> = -<span class="fl">1.0</span><span class="bu">f</span>;</span>
<span id="cb248-31"><a href="lookatproject.html#cb248-31"></a>    <span class="cf">if</span> (ev.key.keysym.sym == SDLK_RIGHT || ev.key.keysym.sym == SDLK_d)</span>
<span id="cb248-32"><a href="lookatproject.html#cb248-32"></a>      <span class="va">m_panSpeed</span> = <span class="fl">1.0</span><span class="bu">f</span>;</span>
<span id="cb248-33"><a href="lookatproject.html#cb248-33"></a>    <span class="cf">if</span> (ev.key.keysym.sym == SDLK_q) <span class="va">m_truckSpeed</span> = -<span class="fl">1.0</span><span class="bu">f</span>;</span>
<span id="cb248-34"><a href="lookatproject.html#cb248-34"></a>    <span class="cf">if</span> (ev.key.keysym.sym == SDLK_e) <span class="va">m_truckSpeed</span> = <span class="fl">1.0</span><span class="bu">f</span>;</span>
<span id="cb248-35"><a href="lookatproject.html#cb248-35"></a>  }</span>
<span id="cb248-36"><a href="lookatproject.html#cb248-36"></a>  <span class="cf">if</span> (ev.type == SDL_KEYUP) {</span>
<span id="cb248-37"><a href="lookatproject.html#cb248-37"></a>    <span class="cf">if</span> ((ev.key.keysym.sym == SDLK_UP || ev.key.keysym.sym == SDLK_w) &amp;&amp;</span>
<span id="cb248-38"><a href="lookatproject.html#cb248-38"></a>        <span class="va">m_dollySpeed</span> &gt; <span class="dv">0</span>)</span>
<span id="cb248-39"><a href="lookatproject.html#cb248-39"></a>      <span class="va">m_dollySpeed</span> = <span class="fl">0.0</span><span class="bu">f</span>;</span>
<span id="cb248-40"><a href="lookatproject.html#cb248-40"></a>    <span class="cf">if</span> ((ev.key.keysym.sym == SDLK_DOWN || ev.key.keysym.sym == SDLK_s) &amp;&amp;</span>
<span id="cb248-41"><a href="lookatproject.html#cb248-41"></a>        <span class="va">m_dollySpeed</span> &lt; <span class="dv">0</span>)</span>
<span id="cb248-42"><a href="lookatproject.html#cb248-42"></a>      <span class="va">m_dollySpeed</span> = <span class="fl">0.0</span><span class="bu">f</span>;</span>
<span id="cb248-43"><a href="lookatproject.html#cb248-43"></a>    <span class="cf">if</span> ((ev.key.keysym.sym == SDLK_LEFT || ev.key.keysym.sym == SDLK_a) &amp;&amp;</span>
<span id="cb248-44"><a href="lookatproject.html#cb248-44"></a>        <span class="va">m_panSpeed</span> &lt; <span class="dv">0</span>)</span>
<span id="cb248-45"><a href="lookatproject.html#cb248-45"></a>      <span class="va">m_panSpeed</span> = <span class="fl">0.0</span><span class="bu">f</span>;</span>
<span id="cb248-46"><a href="lookatproject.html#cb248-46"></a>    <span class="cf">if</span> ((ev.key.keysym.sym == SDLK_RIGHT || ev.key.keysym.sym == SDLK_d) &amp;&amp;</span>
<span id="cb248-47"><a href="lookatproject.html#cb248-47"></a>        <span class="va">m_panSpeed</span> &gt; <span class="dv">0</span>)</span>
<span id="cb248-48"><a href="lookatproject.html#cb248-48"></a>      <span class="va">m_panSpeed</span> = <span class="fl">0.0</span><span class="bu">f</span>;</span>
<span id="cb248-49"><a href="lookatproject.html#cb248-49"></a>    <span class="cf">if</span> (ev.key.keysym.sym == SDLK_q &amp;&amp; <span class="va">m_truckSpeed</span> &lt; <span class="dv">0</span>) <span class="va">m_truckSpeed</span> = <span class="fl">0.0</span><span class="bu">f</span>;</span>
<span id="cb248-50"><a href="lookatproject.html#cb248-50"></a>    <span class="cf">if</span> (ev.key.keysym.sym == SDLK_e &amp;&amp; <span class="va">m_truckSpeed</span> &gt; <span class="dv">0</span>) <span class="va">m_truckSpeed</span> = <span class="fl">0.0</span><span class="bu">f</span>;</span>
<span id="cb248-51"><a href="lookatproject.html#cb248-51"></a>  }</span>
<span id="cb248-52"><a href="lookatproject.html#cb248-52"></a>}</span></code></pre></div>
<p>Os eventos de teclado são tratados para teclas pressionadas (linhas 24 a 35) e teclas liberadas (linhas 36 a 51).</p>
<p>Quando uma tecla é pressionada (seta ou <code>QWEASD</code>), a velocidade de dolly, pan ou truck é alterada para +1 ou -1. Quando a tecla é solta, a velocidade correspondente volta para 0.</p>
<p>Vamos agora à definição de <code>OpenGLWindow::initializeOpenGL</code>, que também é bem parecida com a do projeto <code>loadmodel</code>:</p>
<div class="sourceCode" id="cb249" startFrom="54"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 53;"><span id="cb249-54"><a href="lookatproject.html#cb249-54"></a><span class="dt">void</span> OpenGLWindow::initializeGL() {</span>
<span id="cb249-55"><a href="lookatproject.html#cb249-55"></a>  glClearColor(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>);</span>
<span id="cb249-56"><a href="lookatproject.html#cb249-56"></a></span>
<span id="cb249-57"><a href="lookatproject.html#cb249-57"></a>  <span class="co">// Enable depth buffering</span></span>
<span id="cb249-58"><a href="lookatproject.html#cb249-58"></a>  glEnable(GL_DEPTH_TEST);</span>
<span id="cb249-59"><a href="lookatproject.html#cb249-59"></a></span>
<span id="cb249-60"><a href="lookatproject.html#cb249-60"></a>  <span class="co">// Create program</span></span>
<span id="cb249-61"><a href="lookatproject.html#cb249-61"></a>  <span class="va">m_program</span> = createProgramFromFile(getAssetsPath() + <span class="st">&quot;lookat.vert&quot;</span>,</span>
<span id="cb249-62"><a href="lookatproject.html#cb249-62"></a>                                    getAssetsPath() + <span class="st">&quot;lookat.frag&quot;</span>);</span>
<span id="cb249-63"><a href="lookatproject.html#cb249-63"></a></span>
<span id="cb249-64"><a href="lookatproject.html#cb249-64"></a>  <span class="co">// Load model</span></span>
<span id="cb249-65"><a href="lookatproject.html#cb249-65"></a>  loadModelFromFile(getAssetsPath() + <span class="st">&quot;bunny.obj&quot;</span>);</span>
<span id="cb249-66"><a href="lookatproject.html#cb249-66"></a></span>
<span id="cb249-67"><a href="lookatproject.html#cb249-67"></a>  <span class="co">// Generate VBO</span></span>
<span id="cb249-68"><a href="lookatproject.html#cb249-68"></a>  glGenBuffers(<span class="dv">1</span>, &amp;<span class="va">m_VBO</span>);</span>
<span id="cb249-69"><a href="lookatproject.html#cb249-69"></a>  glBindBuffer(GL_ARRAY_BUFFER, <span class="va">m_VBO</span>);</span>
<span id="cb249-70"><a href="lookatproject.html#cb249-70"></a>  glBufferData(GL_ARRAY_BUFFER, <span class="kw">sizeof</span>(<span class="va">m_vertices</span>[<span class="dv">0</span>]) * <span class="va">m_vertices</span>.size(),</span>
<span id="cb249-71"><a href="lookatproject.html#cb249-71"></a>               <span class="va">m_vertices</span>.data(), GL_STATIC_DRAW);</span>
<span id="cb249-72"><a href="lookatproject.html#cb249-72"></a>  glBindBuffer(GL_ARRAY_BUFFER, <span class="dv">0</span>);</span>
<span id="cb249-73"><a href="lookatproject.html#cb249-73"></a></span>
<span id="cb249-74"><a href="lookatproject.html#cb249-74"></a>  <span class="co">// Generate EBO</span></span>
<span id="cb249-75"><a href="lookatproject.html#cb249-75"></a>  glGenBuffers(<span class="dv">1</span>, &amp;<span class="va">m_EBO</span>);</span>
<span id="cb249-76"><a href="lookatproject.html#cb249-76"></a>  glBindBuffer(GL_ELEMENT_ARRAY_BUFFER, <span class="va">m_EBO</span>);</span>
<span id="cb249-77"><a href="lookatproject.html#cb249-77"></a>  glBufferData(GL_ELEMENT_ARRAY_BUFFER, <span class="kw">sizeof</span>(<span class="va">m_indices</span>[<span class="dv">0</span>]) * <span class="va">m_indices</span>.size(),</span>
<span id="cb249-78"><a href="lookatproject.html#cb249-78"></a>               <span class="va">m_indices</span>.data(), GL_STATIC_DRAW);</span>
<span id="cb249-79"><a href="lookatproject.html#cb249-79"></a>  glBindBuffer(GL_ELEMENT_ARRAY_BUFFER, <span class="dv">0</span>);</span>
<span id="cb249-80"><a href="lookatproject.html#cb249-80"></a></span>
<span id="cb249-81"><a href="lookatproject.html#cb249-81"></a>  <span class="co">// Create VAO</span></span>
<span id="cb249-82"><a href="lookatproject.html#cb249-82"></a>  glGenVertexArrays(<span class="dv">1</span>, &amp;<span class="va">m_VAO</span>);</span>
<span id="cb249-83"><a href="lookatproject.html#cb249-83"></a></span>
<span id="cb249-84"><a href="lookatproject.html#cb249-84"></a>  <span class="co">// Bind vertex attributes to current VAO</span></span>
<span id="cb249-85"><a href="lookatproject.html#cb249-85"></a>  glBindVertexArray(<span class="va">m_VAO</span>);</span>
<span id="cb249-86"><a href="lookatproject.html#cb249-86"></a></span>
<span id="cb249-87"><a href="lookatproject.html#cb249-87"></a>  glBindBuffer(GL_ARRAY_BUFFER, <span class="va">m_VBO</span>);</span>
<span id="cb249-88"><a href="lookatproject.html#cb249-88"></a>  GLint positionAttribute{glGetAttribLocation(<span class="va">m_program</span>, <span class="st">&quot;inPosition&quot;</span>)};</span>
<span id="cb249-89"><a href="lookatproject.html#cb249-89"></a>  glEnableVertexAttribArray(positionAttribute);</span>
<span id="cb249-90"><a href="lookatproject.html#cb249-90"></a>  glVertexAttribPointer(positionAttribute, <span class="dv">3</span>, GL_FLOAT, GL_FALSE,</span>
<span id="cb249-91"><a href="lookatproject.html#cb249-91"></a>                        <span class="kw">sizeof</span>(Vertex), <span class="kw">nullptr</span>);</span>
<span id="cb249-92"><a href="lookatproject.html#cb249-92"></a>  glBindBuffer(GL_ARRAY_BUFFER, <span class="dv">0</span>);</span>
<span id="cb249-93"><a href="lookatproject.html#cb249-93"></a></span>
<span id="cb249-94"><a href="lookatproject.html#cb249-94"></a>  glBindBuffer(GL_ELEMENT_ARRAY_BUFFER, <span class="va">m_EBO</span>);</span>
<span id="cb249-95"><a href="lookatproject.html#cb249-95"></a></span>
<span id="cb249-96"><a href="lookatproject.html#cb249-96"></a>  <span class="co">// End of binding to current VAO</span></span>
<span id="cb249-97"><a href="lookatproject.html#cb249-97"></a>  glBindVertexArray(<span class="dv">0</span>);</span>
<span id="cb249-98"><a href="lookatproject.html#cb249-98"></a></span>
<span id="cb249-99"><a href="lookatproject.html#cb249-99"></a>  resizeGL(getWindowSettings().width, getWindowSettings().height);</span>
<span id="cb249-100"><a href="lookatproject.html#cb249-100"></a>}</span></code></pre></div>
<p>Só modificamos o nomes dos shaders lidos nas linhas 61 a 62, e incluímos a chamada a <code>OpenGLWindow::resizeGL</code> na linha 99.</p>
<p>O método <code>Camera::computeProjectioMatrix</code> é chamado dentro de <code>OpenGLWindow::resizeGL</code> para reconstruir a matriz de projeção. Ao chamar <code>OpenGLWindow::resizeGL</code> em <code>OpenGLWindow::initializeGL</code>, garantimos que a aplicação começará com uma matriz de projeção válida (os valores da matriz dependem do tamanho atual da janela).</p>
<p>A definição de <code>OpenGLWindow::loadModelFromFile</code> é a mesma do projeto anterior.</p>
<p>Vamos à definição de <code>OpenGLWindow::paintGL</code>:</p>
<div class="sourceCode" id="cb250" startFrom="169"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 168;"><span id="cb250-169"><a href="lookatproject.html#cb250-169"></a><span class="dt">void</span> OpenGLWindow::paintGL() {</span>
<span id="cb250-170"><a href="lookatproject.html#cb250-170"></a>  update();</span>
<span id="cb250-171"><a href="lookatproject.html#cb250-171"></a></span>
<span id="cb250-172"><a href="lookatproject.html#cb250-172"></a>  <span class="co">// Clear color buffer and depth buffer</span></span>
<span id="cb250-173"><a href="lookatproject.html#cb250-173"></a>  glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</span>
<span id="cb250-174"><a href="lookatproject.html#cb250-174"></a></span>
<span id="cb250-175"><a href="lookatproject.html#cb250-175"></a>  glViewport(<span class="dv">0</span>, <span class="dv">0</span>, <span class="va">m_viewportWidth</span>, <span class="va">m_viewportHeight</span>);</span>
<span id="cb250-176"><a href="lookatproject.html#cb250-176"></a></span>
<span id="cb250-177"><a href="lookatproject.html#cb250-177"></a>  glUseProgram(<span class="va">m_program</span>);</span>
<span id="cb250-178"><a href="lookatproject.html#cb250-178"></a>  glBindVertexArray(<span class="va">m_VAO</span>);</span>
<span id="cb250-179"><a href="lookatproject.html#cb250-179"></a></span>
<span id="cb250-180"><a href="lookatproject.html#cb250-180"></a>  <span class="co">// Get location of uniform variables (could be precomputed)</span></span>
<span id="cb250-181"><a href="lookatproject.html#cb250-181"></a>  GLint viewMatrixLoc{glGetUniformLocation(<span class="va">m_program</span>, <span class="st">&quot;viewMatrix&quot;</span>)};</span>
<span id="cb250-182"><a href="lookatproject.html#cb250-182"></a>  GLint projMatrixLoc{glGetUniformLocation(<span class="va">m_program</span>, <span class="st">&quot;projMatrix&quot;</span>)};</span>
<span id="cb250-183"><a href="lookatproject.html#cb250-183"></a>  GLint modelMatrixLoc{glGetUniformLocation(<span class="va">m_program</span>, <span class="st">&quot;modelMatrix&quot;</span>)};</span>
<span id="cb250-184"><a href="lookatproject.html#cb250-184"></a>  GLint colorLoc{glGetUniformLocation(<span class="va">m_program</span>, <span class="st">&quot;color&quot;</span>)};</span>
<span id="cb250-185"><a href="lookatproject.html#cb250-185"></a></span>
<span id="cb250-186"><a href="lookatproject.html#cb250-186"></a>  <span class="co">// Set uniform variables for viewMatrix and projMatrix</span></span>
<span id="cb250-187"><a href="lookatproject.html#cb250-187"></a>  <span class="co">// These matrices are used for every scene object</span></span>
<span id="cb250-188"><a href="lookatproject.html#cb250-188"></a>  glUniformMatrix4fv(viewMatrixLoc, <span class="dv">1</span>, GL_FALSE, &amp;<span class="va">m_camera</span>.<span class="va">m_viewMatrix</span>[<span class="dv">0</span>][<span class="dv">0</span>]);</span>
<span id="cb250-189"><a href="lookatproject.html#cb250-189"></a>  glUniformMatrix4fv(projMatrixLoc, <span class="dv">1</span>, GL_FALSE, &amp;<span class="va">m_camera</span>.<span class="va">m_projMatrix</span>[<span class="dv">0</span>][<span class="dv">0</span>]);</span>
<span id="cb250-190"><a href="lookatproject.html#cb250-190"></a></span>
<span id="cb250-191"><a href="lookatproject.html#cb250-191"></a>  <span class="co">// Draw white bunny</span></span>
<span id="cb250-192"><a href="lookatproject.html#cb250-192"></a>  glm::mat4 model{<span class="fl">1.0</span><span class="bu">f</span>};</span>
<span id="cb250-193"><a href="lookatproject.html#cb250-193"></a>  model = glm::translate(model, glm::vec3(-<span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">0.0</span><span class="bu">f</span>, <span class="fl">0.0</span><span class="bu">f</span>));</span>
<span id="cb250-194"><a href="lookatproject.html#cb250-194"></a>  model = glm::rotate(model, glm::radians(<span class="fl">90.0</span><span class="bu">f</span>), glm::vec3(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>));</span>
<span id="cb250-195"><a href="lookatproject.html#cb250-195"></a>  model = glm::scale(model, glm::vec3(<span class="fl">0.5</span><span class="bu">f</span>));</span>
<span id="cb250-196"><a href="lookatproject.html#cb250-196"></a></span>
<span id="cb250-197"><a href="lookatproject.html#cb250-197"></a>  glUniformMatrix4fv(modelMatrixLoc, <span class="dv">1</span>, GL_FALSE, &amp;model[<span class="dv">0</span>][<span class="dv">0</span>]);</span>
<span id="cb250-198"><a href="lookatproject.html#cb250-198"></a>  glUniform4f(colorLoc, <span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>);</span>
<span id="cb250-199"><a href="lookatproject.html#cb250-199"></a>  glDrawElements(GL_TRIANGLES, <span class="va">m_indices</span>.size(), GL_UNSIGNED_INT, <span class="kw">nullptr</span>);</span>
<span id="cb250-200"><a href="lookatproject.html#cb250-200"></a></span>
<span id="cb250-201"><a href="lookatproject.html#cb250-201"></a>  <span class="co">// Draw yellow bunny</span></span>
<span id="cb250-202"><a href="lookatproject.html#cb250-202"></a>  model = glm::mat4(<span class="fl">1.0</span>);</span>
<span id="cb250-203"><a href="lookatproject.html#cb250-203"></a>  model = glm::translate(model, glm::vec3(<span class="fl">0.0</span><span class="bu">f</span>, <span class="fl">0.0</span><span class="bu">f</span>, -<span class="fl">1.0</span><span class="bu">f</span>));</span>
<span id="cb250-204"><a href="lookatproject.html#cb250-204"></a>  model = glm::scale(model, glm::vec3(<span class="fl">0.5</span><span class="bu">f</span>));</span>
<span id="cb250-205"><a href="lookatproject.html#cb250-205"></a></span>
<span id="cb250-206"><a href="lookatproject.html#cb250-206"></a>  glUniformMatrix4fv(modelMatrixLoc, <span class="dv">1</span>, GL_FALSE, &amp;model[<span class="dv">0</span>][<span class="dv">0</span>]);</span>
<span id="cb250-207"><a href="lookatproject.html#cb250-207"></a>  glUniform4f(colorLoc, <span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">0.8</span><span class="bu">f</span>, <span class="fl">0.0</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>);</span>
<span id="cb250-208"><a href="lookatproject.html#cb250-208"></a>  glDrawElements(GL_TRIANGLES, <span class="va">m_indices</span>.size(), GL_UNSIGNED_INT, <span class="kw">nullptr</span>);</span>
<span id="cb250-209"><a href="lookatproject.html#cb250-209"></a></span>
<span id="cb250-210"><a href="lookatproject.html#cb250-210"></a>  <span class="co">// Draw blue bunny</span></span>
<span id="cb250-211"><a href="lookatproject.html#cb250-211"></a>  model = glm::mat4(<span class="fl">1.0</span>);</span>
<span id="cb250-212"><a href="lookatproject.html#cb250-212"></a>  model = glm::translate(model, glm::vec3(<span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">0.0</span><span class="bu">f</span>, <span class="fl">0.0</span><span class="bu">f</span>));</span>
<span id="cb250-213"><a href="lookatproject.html#cb250-213"></a>  model = glm::rotate(model, glm::radians(-<span class="fl">90.0</span><span class="bu">f</span>), glm::vec3(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>));</span>
<span id="cb250-214"><a href="lookatproject.html#cb250-214"></a>  model = glm::scale(model, glm::vec3(<span class="fl">0.5</span><span class="bu">f</span>));</span>
<span id="cb250-215"><a href="lookatproject.html#cb250-215"></a></span>
<span id="cb250-216"><a href="lookatproject.html#cb250-216"></a>  glUniformMatrix4fv(modelMatrixLoc, <span class="dv">1</span>, GL_FALSE, &amp;model[<span class="dv">0</span>][<span class="dv">0</span>]);</span>
<span id="cb250-217"><a href="lookatproject.html#cb250-217"></a>  glUniform4f(colorLoc, <span class="fl">0.0</span><span class="bu">f</span>, <span class="fl">0.8</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>);</span>
<span id="cb250-218"><a href="lookatproject.html#cb250-218"></a>  glDrawElements(GL_TRIANGLES, <span class="va">m_indices</span>.size(), GL_UNSIGNED_INT, <span class="kw">nullptr</span>);</span>
<span id="cb250-219"><a href="lookatproject.html#cb250-219"></a></span>
<span id="cb250-220"><a href="lookatproject.html#cb250-220"></a>  <span class="co">// Draw red bunny</span></span>
<span id="cb250-221"><a href="lookatproject.html#cb250-221"></a>  model = glm::mat4(<span class="fl">1.0</span>);</span>
<span id="cb250-222"><a href="lookatproject.html#cb250-222"></a>  model = glm::scale(model, glm::vec3(<span class="fl">0.1</span><span class="bu">f</span>));</span>
<span id="cb250-223"><a href="lookatproject.html#cb250-223"></a></span>
<span id="cb250-224"><a href="lookatproject.html#cb250-224"></a>  glUniformMatrix4fv(modelMatrixLoc, <span class="dv">1</span>, GL_FALSE, &amp;model[<span class="dv">0</span>][<span class="dv">0</span>]);</span>
<span id="cb250-225"><a href="lookatproject.html#cb250-225"></a>  glUniform4f(colorLoc, <span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">0.25</span><span class="bu">f</span>, <span class="fl">0.25</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>);</span>
<span id="cb250-226"><a href="lookatproject.html#cb250-226"></a>  glDrawElements(GL_TRIANGLES, <span class="va">m_indices</span>.size(), GL_UNSIGNED_INT, <span class="kw">nullptr</span>);</span>
<span id="cb250-227"><a href="lookatproject.html#cb250-227"></a></span>
<span id="cb250-228"><a href="lookatproject.html#cb250-228"></a>  glBindVertexArray(<span class="dv">0</span>);</span>
<span id="cb250-229"><a href="lookatproject.html#cb250-229"></a>  glUseProgram(<span class="dv">0</span>);</span>
<span id="cb250-230"><a href="lookatproject.html#cb250-230"></a>}</span></code></pre></div>
<p>O método <code>OpenGLWindow::update</code> é chamado logo do início, na linha 170, para atualizar a posição e orientação da câmera LookAt.</p>
<p>Nas linhas 188 e 189, o conteúdo das matrizes de visão e projeção é enviado às variáveis uniformes no shader:</p>
<div class="sourceCode" id="cb251" startFrom="186"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 185;"><span id="cb251-186"><a href="lookatproject.html#cb251-186"></a>  <span class="co">// Set uniform variables for viewMatrix and projMatrix</span></span>
<span id="cb251-187"><a href="lookatproject.html#cb251-187"></a>  <span class="co">// These matrices are used for every scene object</span></span>
<span id="cb251-188"><a href="lookatproject.html#cb251-188"></a>  glUniformMatrix4fv(viewMatrixLoc, <span class="dv">1</span>, GL_FALSE, &amp;<span class="va">m_camera</span>.<span class="va">m_viewMatrix</span>[<span class="dv">0</span>][<span class="dv">0</span>]);</span>
<span id="cb251-189"><a href="lookatproject.html#cb251-189"></a>  glUniformMatrix4fv(projMatrixLoc, <span class="dv">1</span>, GL_FALSE, &amp;<span class="va">m_camera</span>.<span class="va">m_projMatrix</span>[<span class="dv">0</span>][<span class="dv">0</span>]);</span></code></pre></div>
<p>Observe o uso da função <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/glUniform.xhtml"><code>glUniformMatrix4fv</code></a>. Essa função tem a assinatura</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb252-1"><a href="lookatproject.html#cb252-1"></a><span class="dt">void</span> glUniformMatrix4fv(GLint location,</span>
<span id="cb252-2"><a href="lookatproject.html#cb252-2"></a>                        GLsizei count,</span>
<span id="cb252-3"><a href="lookatproject.html#cb252-3"></a>                        GLboolean transpose,</span>
<span id="cb252-4"><a href="lookatproject.html#cb252-4"></a>                        <span class="at">const</span> GLfloat *value);</span></code></pre></div>
<p>onde</p>
<ul>
<li><code>location</code> é o identificador de localização da variável uniforme no shader;</li>
<li><code>count</code> é o número de matrizes que queremos transferir à variável uniforme;</li>
<li><code>transpose</code> é um valor booleano que indica se queremos enviar a transposta da matriz;</li>
<li><code>value</code> é o ponteiro para o primeiro elemento do arranjo de elementos da matriz.</li>
</ul>
<p>A renderização do coelho branco (cinza na <a href="lookatproject.html#fig:lookatproj1">7.32</a>) é configurada nas linhas 191 a 199:</p>
<div class="sourceCode" id="cb253" startFrom="191"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 190;"><span id="cb253-191"><a href="lookatproject.html#cb253-191"></a>  <span class="co">// Draw white bunny</span></span>
<span id="cb253-192"><a href="lookatproject.html#cb253-192"></a>  glm::mat4 model{<span class="fl">1.0</span><span class="bu">f</span>};</span>
<span id="cb253-193"><a href="lookatproject.html#cb253-193"></a>  model = glm::translate(model, glm::vec3(-<span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">0.0</span><span class="bu">f</span>, <span class="fl">0.0</span><span class="bu">f</span>));</span>
<span id="cb253-194"><a href="lookatproject.html#cb253-194"></a>  model = glm::rotate(model, glm::radians(<span class="fl">90.0</span><span class="bu">f</span>), glm::vec3(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>));</span>
<span id="cb253-195"><a href="lookatproject.html#cb253-195"></a>  model = glm::scale(model, glm::vec3(<span class="fl">0.5</span><span class="bu">f</span>));</span>
<span id="cb253-196"><a href="lookatproject.html#cb253-196"></a></span>
<span id="cb253-197"><a href="lookatproject.html#cb253-197"></a>  glUniformMatrix4fv(modelMatrixLoc, <span class="dv">1</span>, GL_FALSE, &amp;model[<span class="dv">0</span>][<span class="dv">0</span>]);</span>
<span id="cb253-198"><a href="lookatproject.html#cb253-198"></a>  glUniform4f(colorLoc, <span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>);</span>
<span id="cb253-199"><a href="lookatproject.html#cb253-199"></a>  glDrawElements(GL_TRIANGLES, <span class="va">m_indices</span>.size(), GL_UNSIGNED_INT, <span class="kw">nullptr</span>);</span></code></pre></div>
<p>Nas linhas 192 a 195 é criada a concatenação de transformações que formam a <strong>matriz de modelo</strong> (<code>model</code>). Para o coelho branco, essa concatenação é</p>
<p><span class="math display">\[
\mathbf{M}_{\textrm{model}}=\mathbf{I}.\mathbf{T}(-1,0,0).\mathbf{R}_y\left(\frac{\pi}{2}\right).\mathbf{S}(0.5, 0.5, 0.5).
\]</span>
Essas transformações servem para posicionar o coelho no mundo. Inicialmente o modelo está na posição e orientação definida no arquivo <code>bunny.obj</code>: na origem, sobre o plano <span class="math inline">\(y=0\)</span>, como vimos na figura <a href="glspaces.html#fig:glspace1">7.17</a>. As transformações são aplicadas da seguinte forma:</p>
<ul>
<li>Transformação de escala para reduzir o tamanho do coelho para <span class="math inline">\(50\%\)</span> de seu tamanho original (linha 195);</li>
<li>Rotação em <span class="math inline">\(90^{\circ}\)</span> em torno do eixo <span class="math inline">\(y\)</span> do espaço do objeto, que é o mesmo eixo <span class="math inline">\(y\)</span> do espaço do mundo (linha 194);</li>
<li>Translação pelo vetor <span class="math inline">\((-1,0,0)\)</span>, que posiciona o coelho em sua posição final na cena (linha 193);</li>
<li>Transformação identidade (linha 192).</li>
</ul>
<p>Na linha 197, a matriz de modelo é enviada à variável uniforme <code>m_modelMatrix</code> no vertex shader.</p>
<p>Na linha 198, a variável uniforme <code>color</code> é definida com <span class="math inline">\((1,1,1,1)\)</span> (cor branca) no vertex shader.</p>
<p>Finalmente, na linha 199 é feita a chamada ao comando de renderização.</p>
<p>Observe como um procedimento semelhante é feito para os outros coelhos. Mudam apenas as transformações que serão usadas para criar a matriz <code>model</code>, e o valor de cor definido na variável uniforme <code>color</code>.</p>
<p>Para o coelho amarelo:</p>
<div class="sourceCode" id="cb254" startFrom="201"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 200;"><span id="cb254-201"><a href="lookatproject.html#cb254-201"></a>  <span class="co">// Draw yellow bunny</span></span>
<span id="cb254-202"><a href="lookatproject.html#cb254-202"></a>  model = glm::mat4(<span class="fl">1.0</span>);</span>
<span id="cb254-203"><a href="lookatproject.html#cb254-203"></a>  model = glm::translate(model, glm::vec3(<span class="fl">0.0</span><span class="bu">f</span>, <span class="fl">0.0</span><span class="bu">f</span>, -<span class="fl">1.0</span><span class="bu">f</span>));</span>
<span id="cb254-204"><a href="lookatproject.html#cb254-204"></a>  model = glm::scale(model, glm::vec3(<span class="fl">0.5</span><span class="bu">f</span>));</span>
<span id="cb254-205"><a href="lookatproject.html#cb254-205"></a></span>
<span id="cb254-206"><a href="lookatproject.html#cb254-206"></a>  glUniformMatrix4fv(modelMatrixLoc, <span class="dv">1</span>, GL_FALSE, &amp;model[<span class="dv">0</span>][<span class="dv">0</span>]);</span>
<span id="cb254-207"><a href="lookatproject.html#cb254-207"></a>  glUniform4f(colorLoc, <span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">0.8</span><span class="bu">f</span>, <span class="fl">0.0</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>);</span>
<span id="cb254-208"><a href="lookatproject.html#cb254-208"></a>  glDrawElements(GL_TRIANGLES, <span class="va">m_indices</span>.size(), GL_UNSIGNED_INT, <span class="kw">nullptr</span>);</span></code></pre></div>
<p>Para o coelho azul:</p>
<div class="sourceCode" id="cb255" startFrom="210"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 209;"><span id="cb255-210"><a href="lookatproject.html#cb255-210"></a>  <span class="co">// Draw blue bunny</span></span>
<span id="cb255-211"><a href="lookatproject.html#cb255-211"></a>  model = glm::mat4(<span class="fl">1.0</span>);</span>
<span id="cb255-212"><a href="lookatproject.html#cb255-212"></a>  model = glm::translate(model, glm::vec3(<span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">0.0</span><span class="bu">f</span>, <span class="fl">0.0</span><span class="bu">f</span>));</span>
<span id="cb255-213"><a href="lookatproject.html#cb255-213"></a>  model = glm::rotate(model, glm::radians(-<span class="fl">90.0</span><span class="bu">f</span>), glm::vec3(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>));</span>
<span id="cb255-214"><a href="lookatproject.html#cb255-214"></a>  model = glm::scale(model, glm::vec3(<span class="fl">0.5</span><span class="bu">f</span>));</span>
<span id="cb255-215"><a href="lookatproject.html#cb255-215"></a></span>
<span id="cb255-216"><a href="lookatproject.html#cb255-216"></a>  glUniformMatrix4fv(modelMatrixLoc, <span class="dv">1</span>, GL_FALSE, &amp;model[<span class="dv">0</span>][<span class="dv">0</span>]);</span>
<span id="cb255-217"><a href="lookatproject.html#cb255-217"></a>  glUniform4f(colorLoc, <span class="fl">0.0</span><span class="bu">f</span>, <span class="fl">0.8</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>);</span>
<span id="cb255-218"><a href="lookatproject.html#cb255-218"></a>  glDrawElements(GL_TRIANGLES, <span class="va">m_indices</span>.size(), GL_UNSIGNED_INT, <span class="kw">nullptr</span>);</span></code></pre></div>
<p>Para o coelho vermelho:</p>
<div class="sourceCode" id="cb256" startFrom="220"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 219;"><span id="cb256-220"><a href="lookatproject.html#cb256-220"></a>  <span class="co">// Draw red bunny</span></span>
<span id="cb256-221"><a href="lookatproject.html#cb256-221"></a>  model = glm::mat4(<span class="fl">1.0</span>);</span>
<span id="cb256-222"><a href="lookatproject.html#cb256-222"></a>  model = glm::scale(model, glm::vec3(<span class="fl">0.1</span><span class="bu">f</span>));</span>
<span id="cb256-223"><a href="lookatproject.html#cb256-223"></a></span>
<span id="cb256-224"><a href="lookatproject.html#cb256-224"></a>  glUniformMatrix4fv(modelMatrixLoc, <span class="dv">1</span>, GL_FALSE, &amp;model[<span class="dv">0</span>][<span class="dv">0</span>]);</span>
<span id="cb256-225"><a href="lookatproject.html#cb256-225"></a>  glUniform4f(colorLoc, <span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">0.25</span><span class="bu">f</span>, <span class="fl">0.25</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>);</span>
<span id="cb256-226"><a href="lookatproject.html#cb256-226"></a>  glDrawElements(GL_TRIANGLES, <span class="va">m_indices</span>.size(), GL_UNSIGNED_INT, <span class="kw">nullptr</span>);</span></code></pre></div>
<p>Note que todos os modelos foram renderizados com o mesmo VAO (linha 178), pois todos os coelhos compartilham o mesmo VBO. É a matriz de modelo que faz com que cada coelho tenha uma transformação diferente no cenário 3D.</p>
<p>A definição de <code>OpenGLWindow::update</code> ficará como a seguir:</p>
<div class="sourceCode" id="cb257" startFrom="248"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 247;"><span id="cb257-248"><a href="lookatproject.html#cb257-248"></a><span class="dt">void</span> OpenGLWindow::update() {</span>
<span id="cb257-249"><a href="lookatproject.html#cb257-249"></a>  <span class="dt">float</span> deltaTime{<span class="kw">static_cast</span>&lt;<span class="dt">float</span>&gt;(getDeltaTime())};</span>
<span id="cb257-250"><a href="lookatproject.html#cb257-250"></a></span>
<span id="cb257-251"><a href="lookatproject.html#cb257-251"></a>  <span class="co">// Update LookAt camera</span></span>
<span id="cb257-252"><a href="lookatproject.html#cb257-252"></a>  <span class="va">m_camera</span>.dolly(<span class="va">m_dollySpeed</span> * deltaTime);</span>
<span id="cb257-253"><a href="lookatproject.html#cb257-253"></a>  <span class="va">m_camera</span>.truck(<span class="va">m_truckSpeed</span> * deltaTime);</span>
<span id="cb257-254"><a href="lookatproject.html#cb257-254"></a>  <span class="va">m_camera</span>.pan(<span class="va">m_panSpeed</span> * deltaTime);</span>
<span id="cb257-255"><a href="lookatproject.html#cb257-255"></a>}</span></code></pre></div>
<p>Aqui, os métodos de movimentação da câmera são chamados usando as variáveis de velocidade que tiveram seus valores determinadoss em <code>OpenGLWindow::handleEvent</code> de acordo com as teclas pressionadas.</p>
<p>O conteúdo restante de <code>openglwindow.cpp</code> é similar ao utilizado nos projetos anteriores.</p>
<p>Baixe o código completo do projeto a partir <a href="http://professor.ufabc.edu.br/~harlen.batagelo/cg/data/lookat.zip">deste link</a>.</p>

</div>
</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="lookat.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="projections.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toc_float": true,
"toolbar": {
"position": "fixed"
},
"search": true,
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
